<!-- <div *ngIf="isLoading" class="overlay">
    <mat-card class="spinnercard" align-items-center>
        <div class="row">
            <div class="col-3">
                <mat-progress-spinner diameter="50" color="primary" mode="indeterminate" strokeWidth="5">
                </mat-progress-spinner>
            </div>
            <div class="col">
                <h4 class="spinnertext">{{loadingmessage}}</h4>
            </div>
        </div>
    </mat-card>
</div> -->
<div *ngIf="isLoading" class="progress-loader">
  <div id="pause" class="d-flex align-items-center justify-content-center">
    <div id="spinner" style="background: #fff;padding: 25px;border-radius: 5px; width: 19rem;" class="row">
      <div class="loading-message bkgg col-9">{{loadingmessage}}</div>
      <div class="col-3" style="top: 5px;">
        <div class="snippet" data-title=".dot-pulse">
          <div class="stage">
            <div class="dot-pulse"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="col-12  col-sm-6">
      <div class="row align-items-center">
        <h4 class="title">
          Request Details
        </h4>
        <!-- <countdown-timer
            *ngIf="(isUserDesigner && this.data.prelim.status == 'designassigned') || (isUserAnalyst && this.data.prelim.status == 'reviewassigned') || (this.data.prelim.reviewassignedto != null && this.data.prelim.reviewassignedto.id == loggedInUser.id && this.data.prelim.status == 'reviewassigned')"
            class="ml-4" [countDownTimerConfig]="remainingtimeconfig">{{data.prelim.designremainingtime}}
        </countdown-timer> -->

      </div>
    </div>
    <div class="col-12 col-sm-6">
      <div class="d-flex align-items-center justify-content-end">
        <button mat-button (click)="getGuidelines('GuidelinesLink')" class="title"
          *ngIf="showguidelinelink && (this.isUserAnalyst || isUserDesigner)">
          <span class="cust-badge" *ngIf="showGuidelineNew">New</span>
          Guidelines
        </button>
        <button *ngIf="isprelimEditable || ispermitEditable || ispestampEditable || issurveyEditable" mat-icon-button
          (click)="onEditClick()">
          <img class="dialogclose" src="../../../../../assets/edit.svg" />
        </button>

        <span class="tableactionbutton"
          *ngIf="isprelimDeletable || ispermitDeletable || issurveyDeletable || ispestampDeletable">
          <button mat-icon-button (click)="onDeleteClick()">
            <img class="dialogclose" src="../../../../../assets/delete.svg" />
          </button>
        </span>
        <!--span class="tableactionbutton">
                    <h4 class="title " (click)="getGuidelines()" style="margin-bottom: auto; padding-right: 8px;">
                    Guidelines
                    </h4>
                </span-->
        <span class="tableactionbutton">
          <button mat-icon-button (click)="onCloseClick()" class="float-right">
            <img class="dialogclose" src="../../../../../assets/close.svg" />
          </button>
        </span>
      </div>
    </div>
  </div>
</div>
<div mat-dialog-content class="permitdetail-dialogcontent">
  <mat-tab-group mat-align-tabs="center">
    <mat-tab *ngIf="data.prelim!=null || data.prelim!=undefined">
      <ng-template matTabLabel *ngIf="isClient">
        {{userSettings?.nameprelim}}
      </ng-template>
      <ng-template matTabLabel *ngIf="!isClient">
        Sales Proposal
      </ng-template>
      <div class="container detailsdialog">
        <div class="row mt-3">
          <div class="col-12 col-sm-6">
            <p class="subtitle fullwidth">Customer and Site Details</p>
            <div class="row subbody">
              <div class="col-6">
                <p class="contentheader">Company</p>
                <p class="contentheader">Name</p>
                <p class="contentheader">Email</p>
                <p class="contentheader">Created By</p>
                <p class="contentheader">Annual Units</p>
                <p class="contentheader">Address</p>
              </div>
              <div class="col-6">
                <p class="contentvalue text-right">{{ data.prelim?.company || defaultvalue}}</p>
                <p class="contentvalue text-right">{{ data.prelim?.name || defaultvalue }}</p>
                <p class="contentvalue text-right">{{ data.prelim?.email || defaultvalue }}</p>
                <p class="contentvalue text-right">{{ data.prelim.createdby.firstname }} {{
                  data.prelim.createdby.lastname }}</p>
                <p class="contentvalue text-right">{{ data.prelim?.monthlybill || defaultvalue }} kW
                </p>
                <p class="contentvalue text-right">{{ data.prelim?.address || defaultvalue}}
                </p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6">
            <p class="subtitle fullwidth">Job Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Property Type</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right" *ngIf="data.prelim.projecttype == 'detachedbuildingorshop'">
                  Detached Building or Shop</p>
                <p class="contentvalue text-right" *ngIf="data.prelim.projecttype != 'detachedbuildingorshop'">
                  {{ data.prelim.projecttype | titlecase }}</p>
              </div>
            </div>
          </div>
          <!-- <div class="col-12  col-sm-6 mt-5">
                        <p class="subtitle fullwidth">Module Details</p>
                        <div class="row subbody">
                            <div class="col" >
                                <p class="contentheader">Make</p>
                                <p class="contentheader">Model</p>
                            </div>
                            <div class="col">
                                <p class="contentvalue text-right" *ngIf="data.prelim.solarmake?.name != null">{{ data.prelim.solarmake?.name || defaultvalue}}</p>
                                <p class="contentvalue text-right" *ngIf="data.prelim.newmodulemake != null">{{ data.prelim.newmodulemake || defaultvalue}}</p>
                                <mat-select *ngIf="(data.prelim.solarmake?.name == null && data.prelim.newmodulemake == null) && (isUserDesigner || isUserAnalyst) " style="background-color: white; width: 90%; float:right;margin-bottom: 5px;" [formControl]="modulemake" #singleSelect placeholder= "  Module Make">
                                    <mat-option>
                                      <ngx-mat-select-search [formControl]="modulemakefilter"  placeholderLabel="Search">
                                      </ngx-mat-select-search>
                                    </mat-option>
                                    <mat-option (onSelectionChange)="fetchModuleModelsData($event,modulemake)" *ngFor="let modulemake of filteredModuleMakes | async" [value]="modulemake.id"
                                     >{{modulemake.name}}</mat-option>
                                
                                  </mat-select>
                                  <mat-error *ngIf="modulemake.invalid" class="error">{{getErrorMessage(modulemake)}}</mat-error>
                                
                                <p class="contentvalue text-right" *ngIf="data.prelim.solarmodel?.name != null">{{ data.prelim.solarmodel?.name || defaultvalue}}</p>
                                <p class="contentvalue text-right" *ngIf="data.prelim.newmodulemade != null">{{ data.prelim.newmodulemade || defaultvalue}}</p>
                                <mat-select *ngIf="(data.prelim.solarmodel?.name == null && data.prelim.newmodulemade == null) && (isUserDesigner || isUserAnalyst) " style="background-color: white; width: 90%; float:right;margin-bottom: 5px;" [formControl]="modulemodel" #singleSelect placeholder="  Module Model"
                               >
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="modulemodelfilter" placeholderLabel="Search">
                                    </ngx-mat-select-search>
                                  </mat-option>
                                  <mat-option *ngFor="let modulemodel of filteredModuleModels | async" [value]="modulemodel.id"
                                  >{{modulemodel.name}}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="modulemodel.invalid" class="error">{{getErrorMessage(modulemodel)}}</mat-error>
                            </div>
                        </div>
                        </div> -->
          <!-- <div class="row mt-3" *ngIf="isUserDesigner && (data.prelim.solarmake?.name == null || data.prelim.solarmodel?.name == null)">
                            <div class="col">
                             
                                <mat-select *ngIf="data.prelim.solarmake?.name == null" style="background-color: white;" [formControl]="modulemake" #singleSelect placeholder= "  Module Make">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="modulemakefilter"  placeholderLabel="Search">
                                    </ngx-mat-select-search>
                                  </mat-option>
                                  <mat-option (onSelectionChange)="fetchModuleModelsData($event,modulemake)" *ngFor="let modulemake of filteredModuleMakes | async" [value]="modulemake.id"
                                   >{{modulemake.name}}</mat-option>
                              
                                </mat-select>
                                <mat-error *ngIf="modulemake.invalid">{{getErrorMessage(modulemake)}}</mat-error>
                            </div>
                            <div class="col">
                            
                                <mat-select *ngIf="data.prelim.solarmodel?.name == null" style="background-color: white;" [formControl]="modulemodel" #singleSelect placeholder="  Module Model"
                               >
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="modulemodelfilter" placeholderLabel="Search">
                                    </ngx-mat-select-search>
                                  </mat-option>
                                  <mat-option *ngFor="let modulemodel of filteredModuleModels | async" [value]="modulemodel.id"
                                  >{{modulemodel.name}}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="modulemodel.invalid">{{getErrorMessage(modulemodel)}}</mat-error>
                            </div>
                  
                          </div> -->


          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Module Details</p>
            <ng-container>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Make</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.prelim.solarmake?.name != null">{{ data.prelim.solarmake?.name || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.prelim.newmodulemake != null">{{ data.prelim.newmodulemake || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(data.prelim.solarmake?.name == null && data.prelim.newmodulemake == null)&& (!isUserDesigner && !isUserAnalyst) ">
                    {{defaultvalue}}</p>
                  <mat-select
                    *ngIf="(data.prelim.solarmake?.name == null && data.prelim.newmodulemake == null)&& (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" [formControl]="modulemake"
                    #singleSelect placeholder="  Module Make">
                    <mat-option>
                      <ngx-mat-select-search [formControl]="modulemakefilter" placeholderLabel="Search">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option (onSelectionChange)="fetchModuleModelsData($event,modulemake)"
                      *ngFor="let modulemake of filteredModuleMakes | async" [value]="modulemake.id">{{modulemake.name}}
                    </mat-option>

                  </mat-select>
                </div>
                <mat-error [hidden]="prelimdisplayerror" *ngIf="modulemake.invalid" class="error"
                  style="margin-left: 50%;">{{getErrorMessage(modulemake)}}</mat-error>
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Model</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.prelim.solarmodel?.name != null">{{ data.prelim.solarmodel?.name || defaultvalue}}
                  </p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.prelim.newmodulemade != null">{{ data.prelim.newmodulemade || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(data.prelim.solarmodel?.name == null && data.prelim.newmodulemade == null)&& (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <mat-select
                    *ngIf="(data.prelim.solarmodel?.name == null && data.prelim.newmodulemade == null)&& (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" [formControl]="modulemodel"
                    #singleSelect placeholder="  Module Model">
                    <mat-option>
                      <ngx-mat-select-search [formControl]="modulemodelfilter" placeholderLabel="Search">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let modulemodel of filteredModuleModels | async" [value]="modulemodel.id"
                      (onSelectionChange)="setmodulemodelid(modulemodel)">
                      {{modulemodel.name}}</mat-option>
                  </mat-select>
                </div>
                <mat-error [hidden]="prelimdisplayerror" *ngIf="modulemodel.invalid" class="error"
                  style="margin-left: 50%;">{{getErrorMessage(modulemodel)}}</mat-error>
              </div>
            </ng-container>
          </div>

          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Inverter Details</p>
            <ng-container *ngFor="let inverters of data.prelim?.designinverters; let i = index">
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Make</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.invertermake?.name != null">{{ inverters.invertermake?.name ||
                    defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(inverters.invertermake?.name == null )&& (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.newinvertermake != null">{{ inverters.newinvertermake ||
                    defaultvalue}}</p>
                  <mat-select *ngIf="(inverters.invertermake?.name == null)&& (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" #singleSelect
                    placeholder="  Inverter Make" (selectionChange)="fetchInverterModelsData($event.value,i)">
                    <input matInput placeholder="Search here" style="height: 29px;padding-left: 10px;font-size: 11px !important;
                    " (keyup)="searchinvertermodels($event)" />
                    <mat-option *ngFor="let invertermake of invertermakes | filterBy: searchTerm;"
                      [value]="invertermake">{{invertermake.name}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Model</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.invertermodel?.name != null">{{ inverters.invertermodel?.name
                    || defaultvalue}}
                  </p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(inverters.invertermodel?.name == null )&& (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}
                  </p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.newinvertermade != null">{{ inverters.newinvertermade ||
                    defaultvalue}}</p>
                  <mat-select
                    *ngIf="(inverters.invertermodel?.name == null && inverters.newinvertermade == null) && (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" #singleSelect
                    placeholder="  Inverter Model">
                    <input matInput placeholder="Search here" style="height: 29px;padding-left: 10px;font-size: 11px !important;
                     " (keyup)="searchinvertermodels($event)" />
                    <mat-option (onSelectionChange)="setPrelimInverterModelValue($event,invertermodel,i)"
                      *ngFor="let invertermodel of inverters.invertermodels | filterBy: searchTerm;"
                      [value]="invertermodel.name">{{invertermodel.name}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Inverters Count</p>
                </div>
                <div class="col-6" style="padding: 0px;">
                  <input
                    *ngIf="(inverters.invertermodel?.name == null || inverters.invertermake?.name == null) && (isUserDesigner || isUserAnalyst) ; else invcount "
                    matInput style="background-color: white;width: 94%;padding-left: 5px;" type="text"
                    (keypress)="numberOnly($event)" autocomplete="off" maxlength="7" matInput
                    (keyup)="setPrelimInverterscount($event,i)" [value]="inverters.inverterscount">
                  <ng-template #invcount>
                    <p style="padding-right: 6%;float: right;"> {{inverters.inverterscount}} </p>
                  </ng-template>
                </div>
              </div>
            </ng-container>
            <mat-error [hidden]="prelimdisplayerror" class="error" style="margin-left: 50%;">Please enter any
              value in all fields</mat-error>
          </div>

          <div class="col-12 mt-5"
            *ngIf="(data.prelim?.solarmake == null || data.prelim?.solarmodel == null || saveinverters )&& (isUserDesigner || isUserAnalyst)">
            <button mat-raised-button (click)="savemodels()"
              style="line-height: 25px !important; display:flex; justify-content:center;float: right;">Save</button>
          </div>

          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Construction Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">New Construction</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{
                  genericService?.getBooleanValue(data.prelim.newconstruction) || defaultvalue}}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="this.data.prelim.newconstruction && data.prelim.architecturaldesign?.length > 0">
            <p class="subtitle fullwidth">Architectural Design</p>
            <div class="row subbody list-border">
              <!-- <div class="col-2"> -->
              <!-- <p class="contentheader">
                  <img *ngIf="designfile.ext == '.pdf'" class="material-icons icon" src="./../assets/pdf.svg" />
                  <img *ngIf="designfile.ext == '.png'" class="material-icons file-icon" src="./../assets/png.svg" />
                  <img *ngIf="designfile.ext == '.zip'" class="material-icons file-icon" src="./../assets/zip.svg" />
                  <img *ngIf="designfile.ext == '.doc'" class="material-icons file-icon" src="./../assets/doc.svg" />
                  <img *ngIf="designfile.ext == '.docx'" class="material-icons file-icon" src="./../assets/doc.svg" />
                  <img *ngIf="designfile.ext == '.odt'" class="material-icons file-icon" src="./../assets/pdf.svg" />
                  <img *ngIf="designfile.ext == '.rtf'" class="material-icons file-icon" src="./../assets/rtf.svg" />
                  <img *ngIf="designfile.ext == '.txt'" class="material-icons file-icon" src="./../assets/txt.svg" />
                  <a (mouseenter)="hoverIdx = i" (mouseleave)="hoverIdx = -1">
                    <span [ngClass]="{ 'overlay-icon': true, 'hide': hoverIdx != i }">
                      <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                        (click)="downloadSingleImage(attachmentfile)" />
                    </span>
                    <img *ngIf="
                      designfile.ext != '.png' &&
                      designfile.ext != '.pdf' &&
                      designfile.ext != '.zip' &&
                      designfile.ext != '.doc' &&
                      designfile.ext != '.docx' &&
                      designfile.ext != '.odt' &&
                      designfile.ext != '.rtf' &&
                      designfile.ext != '.txt'
                    " class="material-icons file-icon" src="./../assets/file.svg" />
                  </a>
                </p> -->
              <p class="image-container" *ngFor="let designfile of prelimarchitecturefile;let i = index;">
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.pdf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/pdf.svg" width="70px" height="70px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.zip'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/zip.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.doc'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.docx'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.odt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/odt.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.rtf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/rtf.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.txt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/file.svg" width="70px" height="70px" /></a>


                <a style="position: relative;" *ngIf="
                  designfile.data.ext != '.pdf' &&
                  designfile.data.ext != '.zip' &&
                  designfile.data.ext != '.doc' &&
                  designfile.data.ext != '.docx' &&
                  designfile.data.ext != '.odt' &&
                  designfile.data.ext != '.rtf' &&
                  designfile.data.ext != '.txt'
                " (mouseenter)="architecturehoverIdx = i" (mouseleave)="architecturehoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span>
                  <img class="material-icons attachment-img" [gallery]="'prelimarchitecturefile'" [lightbox]="i"
                    [src]="designfile.data.thumb" width="95%" height="95%" />
                </a>

              </p>
              <!-- </div> -->
              <!-- <div class="col-10">
                <a href="{{ designfile.url }}" target="_blank" class="contentvalue float-right">{{ designfile.name |
                  uppercase }}</a>
              </div> -->
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Mounting Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Mounting Type</p>
                <p class="contentheader"
                  *ngIf="data.prelim.mountingtype == 'roof' || data.prelim.mountingtype == 'both'">
                  Roof Type</p>
                <p class="contentheader"
                  *ngIf="data.prelim.mountingtype == 'ground' || data.prelim.mountingtype == 'both'">
                  Tilt for ground mount system</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ (data.prelim?.mountingtype | titlecase) ||
                  defaultvalue}}</p>
                <p class="contentvalue text-right"
                  *ngIf="data.prelim.mountingtype == 'roof' || data.prelim.mountingtype == 'both'">
                  {{ data.prelim.rooftype | titlecase }}</p>
                <p class="contentvalue text-right"
                  *ngIf="data.prelim.mountingtype == 'ground' || data.prelim.mountingtype == 'both'">
                  {{ data.prelim?.tiltofgroundmountingsystem || defaultvalue}}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5" *ngIf="data.prelim.requirementtype=='proposal'">
            <p class="subtitle fullwidth">Utility Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Utility name</p>
                <p class="contentheader">Utility rates</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ data.prelim.utility?.name || defaultvalue }}</p>
                <p class="contentvalue text-right">{{ data.prelim.utilityrate?.rate || defaultvalue }}
                </p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5" *ngIf="data.prelim.requirementtype=='proposal'">
            <p class="subtitle fullwidth">Site Proposal Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Annual utility rate escalation</p>
                <p class="contentheader">Cost of system </p>
                <p class="contentheader">Representative name</p>
                <p class="contentheader">Any Incentives</p>

              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ data.prelim?.annualutilityescalation
                  ||defaultvalue}}%</p>
                <p class="contentvalue text-right">{{ data.prelim?.costofsystem ||defaultvalue}} $/Watt
                </p>
                <p class="contentvalue text-right">{{ data.prelim?.personname || defaultvalue}}</p>
                <p class="contentvalue text-right">{{ data.prelim.incentive?.title || defaultvalue}}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="data.prelim?.requirementtype=='proposal' && this.data.prelim?.createdby?.parent?.logo!=null && this.data.prelim?.createdby?.parent?.usertype=='company'">
            <p class="subtitle fullwidth">Company Logo</p>
            <div class="row subbody list-border">
              <div class="col-2">
                <p class="contentheader">
                  <img *ngIf="this.data.prelim.createdby.parent.logo.ext == '.jpeg'" class="material-icons file-icon"
                    src="./../assets/jpeg.svg">
                  <img *ngIf="this.data.prelim.createdby.parent.logo.ext == '.png'" class="material-icons file-icon"
                    src="./../assets/png.svg">
                  <img *ngIf="this.data.prelim.createdby.parent.logo.ext == '.jpg'" class="material-icons file-icon"
                    src="./../assets/jpg.svg">
                </p>
              </div>
              <div class="col-10">
                <a href="{{this.data.prelim.createdby.parent.logo.url}}" target="_blank"
                  class="contentvalue float-right">{{
                  this.data.prelim.createdby.parent.logo.name | uppercase }}</a>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5" *ngIf="data.prelim.comments?.length > 0"
            [ngStyle]="showComments? {'display': 'block'} : {'display': 'none'}">
            <p class="subtitle fullwidth">Comments</p>
            <div *ngFor="let comment of data.prelim.comments">
              <div class="row commentslist"
                *ngIf="(isClient && (comment.createdby?.role != 8 && comment?.createdby?.role != 9 && comment?.createdby?.role != 10)) || (!isClient)">
                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(comment.message)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">{{comment.createdby.firstname}}
                  {{comment.createdby.lastname}}
                </p>
                <p class="pl-1 text-right"
                  style="width: 25%; font-style: italic; color: #666666; font-weight: 100;font-weight: bold;">
                  {{ genericService.formatDateInDisplayFormatnew(comment.created_at) }}</p>
              </div>
            </div>
          </div>

          <div class="col-12  col-sm-6 mt-5" *ngIf="data.prelim.attachments?.length > 0">
            <p class="subtitle fullwidth">Attachments</p>
            <div class="row subbody list-border pl-3">
              <p class="image-container" *ngFor="let attachmentfile of prelimAttachments;let i = index">
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.pdf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/pdf.svg" width="70px" height="70px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.zip'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/zip.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.doc'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.docx'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.odt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/odt.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.rtf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/rtf.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.txt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/file.svg" width="70px" height="70px" /></a>


                <a style="position: relative;" *ngIf="
                attachmentfile.data.ext != '.pdf' &&
                attachmentfile.data.ext != '.zip' &&
                attachmentfile.data.ext != '.doc' &&
                attachmentfile.data.ext != '.docx' &&
                attachmentfile.data.ext != '.odt' &&
                attachmentfile.data.ext != '.rtf' &&
                attachmentfile.data.ext != '.txt'
              " (mouseenter)="attachmenthoverIdx = i" (mouseleave)="attachmenthoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span>
                  <img class="material-icons attachment-img" [gallery]="'prelimAttachments'" [lightbox]="i"
                    [src]="attachmentfile.data.thumb" width="95%" height="95%" />
                </a>

              </p>
              <!-- <div class="col-2">
                                <p class="contentheader">
                                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                                        src="./../assets/png.svg">
                                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                                        src="./../assets/zip.svg">
                                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                                        src="./../assets/rtf.svg">
                                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                                        src="./../assets/txt.svg">
                                    <img *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                                        class="material-icons file-icon" src="./../assets/file.svg">
                                </p>
                            </div> -->
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="((data.prelim.status == 'designcompleted' || data.prelim.status == 'reviewassigned' || data.prelim.status == 'reviewpassed' || data.prelim.status == 'reviewfailed' || data.prelim.status == 'delivered'|| data.prelim.status == 'delivered' || (data.prelim.status == 'requestdeclined' && data.prelim.prelimdesign != null) || (data.prelim.status == 'requestaccepted' && data.prelim.unhold && data.prelim.prelimdesign != null) || data.prelim.isinrevisionstate) && !isClient) || (data.prelim.status == 'delivered' && isClient) ">
            <p class="subtitle fullwidth">Sales Proposal Design</p>
            <div class="d-flex justify-content-between">
              <img src="../../../assets/pdf.svg" width="60px" height="60px">
              <a href="{{data.prelim.prelimdesign?.url}}" target="_blank" class="contentvalue"
                style="margin: auto 0px;">{{data.prelim.prelimdesign?.name}}</a>
            </div>
            <button class="float-right"
              *ngIf="(isUserAnalyst && this.data.prelim.status == 'reviewassigned')||(this.data.prelim.status == 'reviewassigned' && this.data.prelim.reviewassignedto.id == this.loggedInUser.id)"
              mat-raised-button (click)="isselfupdateprelim = !isselfupdateprelim">Self Update
            </button>
            <!-- <div class="row subbody">
                            <div class="col">
                                <p class="contentheader">View File</p>
                            </div>
                            <div class="col">
                                <a href="{{data.prelim.prelimdesign.url}}" target="_blank"
                                    class="contentvalue float-right">{{
                                    data.prelim.prelimdesign.name }}</a>
                                <button class="float-right"
                                    *ngIf="(isUserAnalyst && this.data.prelim.status == 'reviewassigned')||(this.data.prelim.status == 'reviewassigned' && this.data.prelim.reviewassignedto.id == this.loggedInUser.id)"
                                    mat-raised-button (click)="isselfupdateprelim = !isselfupdateprelim">Self
                                    Update</button>
                            </div>
                        </div> -->
          </div>
          <!-- <div class="col-12  col-sm-6 mt-5"
                        *ngIf="!isClient && this.data.prelim.reviewissues != '' && (this.data.prelim.status == 'reviewfailed' || this.data.prelim.status == 'reviewpassed' || this.data.prelim.status == 'delivered')">
                        <p class="subtitle fullwidth">Review comments</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="reviewissues"> <span
                                        innerHTML="{{wrapURLs(this.data.prelim.reviewissues)}}"></span>
                                </p>
                            </div>
                            <div class="col">
                                <p class="reviewissues float-right">{{this.data.prelim.reviewassignedto.firstname}}
                                    {{this.data.prelim.reviewassignedto.lastname}}</p>
                            </div>
                        </div>
                    </div> -->
          <div class="col-12  col-sm-6 mt-5 align-items-center"
            *ngIf="this.data.prelim.status == 'requestdeclined' || (data.prelim.unhold && data.prelim.requestdeclinereason)">
            <p class="subtitle fullwidth">On Hold Reason</p>
            <div class="subbody" *ngFor="let reason of data.prelim.onholddesign">
              <div class="row commentslist" *ngIf="reason.status == 'onhold' && reason.comment !== null">

                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(reason.comment)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">{{reason.createdby?.firstname}}
                  {{reason.createdby?.lastname}}
                </p>
                <p class="pl-1 text-right"
                  style="width: 25%; font-style: italic; color: #666666; font-weight: 100;font-weight: bold;padding-right: 4px;">
                  {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
              </div>
              <!-- </div> -->
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="(this.data.prelim.status == 'requestdeclined' && this.data.prelim.requestdeclineattachment?.length > 0) || (data.prelim.unhold && data.prelim.requestdeclineattachment?.length > 0)">
            <p class="subtitle fullwidth">On Hold Attachments</p>
            <ng-container *ngFor="let reason of data.prelim.onholddesign">
              <div *ngIf="reason.status == 'onhold' && reason.file.length" class="row subbody list-border commentslist"
                style="display: flex;">

                <ng-container *ngFor="let attachmentfile of reason.file; let i=index;">
                  <!-- <div class="col-1"> -->
                  <p class="contentheader" style="width: 8%">
                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                      src="{{attachmentfile.url}}">
                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                      src="./../assets/zip.svg">
                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                      src="./../assets/rtf.svg">
                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                      src="./../assets/txt.svg">
                    <img
                      *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                      class="material-icons file-icon" src="./../assets/file.svg">
                  </p>

                  <!-- </div> -->
                  <!-- <div class="col-11" style="display: flex;"> -->
                  <p style="width: 45%; word-wrap: break-word;display: flex">
                    <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                      attachmentfile.name |
                      uppercase }}</a>
                  </p>

                  <p class="pl-1" style="width:25%;justify-content: flex-end;text-align: -webkit-center;">
                    {{reason.createdby?.firstname}} {{reason.createdby?.lastname}}</p>
                  <p class="pl-1"
                    style="width:22%;justify-content: flex-end;font-style: italic; color: #666666; font-weight: 100;font-weight: bold;text-align: -webkit-center;">
                    {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
                  <!-- </div> -->
                </ng-container>

              </div>
            </ng-container>
          </div>

          <!-- un hold reason and attachment-->
          <div class="col-12  col-sm-6 mt-5 align-items-center"
            *ngIf="((data.prelim.unhold && data.prelim.requestunholdreason) || (data.prelim.status == 'requestdeclined' && data.prelim.requestunholdreason))">
            <p class="subtitle fullwidth">Un Hold Reason</p>
            <div class="subbody" *ngFor="let reason of data.prelim.onholddesign">
              <!-- <div class="col" *ngIf="reason.status == 'unhold'">
                                <p class="contentvalue" >{{reason.comment}}</p>
                            </div> -->

              <div class="row commentslist" *ngIf="reason.status == 'unhold' && reason.comment !== null">

                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(reason.comment)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">{{reason.createdby?.firstname}}
                  {{reason.createdby?.lastname}}
                </p>
                <p class="pl-1 text-right"
                  style="width: 25%; font-style: italic; color: #666666; font-weight: 100;font-weight: bold;padding-right: 4px;">
                  {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="(this.data.prelim.status == 'requestdeclined' && this.data.prelim.requestunholdattachment?.length > 0) || (data.prelim.unhold && data.prelim.requestunholdattachment?.length > 0)">
            <p class="subtitle fullwidth">Un Hold Attachments</p>
            <ng-container *ngFor="let reason of data.prelim.onholddesign">
              <div *ngIf="reason.status == 'unhold' && reason.file.length" class="row subbody list-border commentslist">
                <ng-container *ngFor="let attachmentfile of reason.file; let i=index;">
                  <!-- <div class="col-2"> -->
                  <p class="contentheader" style="width: 8%">
                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                      src="{{attachmentfile.url}}">
                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                      src="./../assets/zip.svg">
                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                      src="./../assets/rtf.svg">
                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                      src="./../assets/txt.svg">
                    <img
                      *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                      class="material-icons file-icon" src="./../assets/file.svg">
                  </p>
                  <!-- </div> -->
                  <!-- <div class="col-10"> -->
                  <p style="width: 45%; word-wrap: break-word;display: flex">
                    <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                      attachmentfile.name |
                      uppercase }}</a>
                  </p>

                  <p class="pl-1" style="width:25%;justify-content: flex-end;text-align: -webkit-center;">
                    {{reason.createdby?.firstname}} {{reason.createdby?.lastname}}</p>
                  <p class="pl-1"
                    style="width:22%;justify-content: flex-end;font-style: italic; color: #666666; font-weight: 100;font-weight: bold;text-align: -webkit-center;">
                    {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
                  <!-- </div> -->
                </ng-container>
              </div>
            </ng-container>
          </div>
          <div class="col-sm-6 col-12 mt-5 align-items-center" *ngIf="data.prelim.isinrevisionstate">
            <p class="subtitle fullwidth">Revision Comments</p>
            <div class="row subbody" *ngFor="let revisiondesign of data.prelim.revisiondesign">
              <div class="col d-flex justify-content-between">
                <p class="contentvalue" style="width: 50%;">{{revisiondesign.comment}}</p>
                <p class="contentvalue">{{revisiondesign.createdby != null?
                  revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                  revisiondesign.createdby.lastname: null}}</p>
                <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                  {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="this.data.prelim.isinrevisionstate && this.data.prelim.revisiondesign?.length > 0">
            <p class="subtitle fullwidth">Revision Design</p>
            <div class="row subbody" *ngFor="let revisiondesign of data.prelim.revisiondesign ; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisiondesign.designfile?.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Design file</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let designfile of revisiondesign.designfile">
                    <a href="{{designfile.url}}" target="_blank">{{
                      designfile.name |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisiondesign.createdby != null?
                    revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                    revisiondesign.createdby.lastname: null}}</p>
                </div>
                <div class="col-4">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
                </div>
              </div>
            </div>
            <div class="row subbody" *ngFor="let revisiondesign of data.prelim.revisiondesign; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisiondesign.file.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Attachment</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let file of revisiondesign.file">
                    <a href="{{file.url}}" target="_blank">{{ file.name
                      |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisiondesign.createdby != null?
                    revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                    revisiondesign.createdby.lastname: null}}</p>
                </div>
                <div class="col-4">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
                </div>
              </div>
            </div>
            <!-- <div class="row subbody list-border" *ngFor="let revisiondesign of data.prelim.revisiondesign">
                            <div class="col-6">
                                <!-- <p class="contentheader">comment</p> 
                                <p class="contentheader" *ngIf="revisiondesign.designfile.length != 0">design file</p>
                                <p class="contentheader" *ngIf="revisiondesign.file.length != 0">Attachment</p>
                            </div>
                            <div class="col-6">
                                <!-- <p class="contentvalue text-right">{{revisiondesign.comment}}</p> 
                                <p class="contentvalue text-right" *ngFor="let designfile of revisiondesign.designfile">
                                    <a href="{{designfile.url}}" target="_blank" class="contentvalue float-right">{{
                                        designfile.name |
                                        uppercase }}</a>
                                </p>
                                <p class="contentvalue text-right" *ngFor="let file of revisiondesign.file">
                                    <a href="{{file.url}}" target="_blank" class="contentvalue float-right">{{ file.name
                                        |
                                        uppercase }}</a>
                                </p>
                            </div>
                        </div> -->
          </div>
        </div>
        <div class="row mt-5 w-100 ml-1"
          *ngIf="(this.data.prelim.status == 'designassigned' || this.data.prelim.status == 'reviewfailed') && isUserDesigner">
          <div class="col-12 pb-5" *ngIf="prelimCriteria.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px">
              CheckList* <span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of prelimCriteria; let i = index">
                <div class="col-12">
                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback"
                        (change)="item.feedback == 'null'? item.feedback = true : item.feedback == true? item.feedback = false: item.feedback == false? item.feedback = true: null; onSaveCritetriaPrelimChecklist(item,i)">
                      <img src="../../../assets/message.svg" width="23px" height="20px"
                        (click)="ShowCommentCriteria(item)"
                        *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)">
                    </div>

                  </div>

                  <ng-container *ngIf="!item.feedback">
                    <div class="row" *ngFor="let comment of item.comments; let j = index"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">
                        <div class="row" style="margin-left:0px">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                          <div class="col-4 d-flex justify-content-end"
                            *ngIf="loggedInUser.id==comment.createdby?.id && j==item.comments.length-1">
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/edit.svg"
                                (click)="editChecklistComment(comment,i,j,item)"></button>
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/delete.svg"
                                (click)="deleteChecklistCommentPrelimChecklist(comment,i,j)"></button>
                          </div>
                        </div>
                        <mat-divider class="divider"></mat-divider>
                        <!-- <div class="row">
                                                <div class="col-12" ></div>
                                                </div>     -->

                        <!-- <hr /> -->
                      </div>
                    </div>
                  </ng-container>

                </div>


                <div class="col-12 pl-3 mt-2"
                  *ngIf="(isciteriacommentshow && selectedCriteria.id == item.id) || (isEditChecklist && selectedCriteria.id == item.id)">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="checklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button *ngIf="!isEditChecklist"
                        (click)="onSaveCritetriaPrelimChecklist(item,i)">Save</button>
                      <button mat-raised-button *ngIf="isEditChecklist"
                        (click)="onEditCommentsPrelimChecklist()">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
          <div class="col-6 align-items-center">
            <p class="subtitle fullwidth">Upload Sales Proposal Design*
              <span style="color: red; " *ngIf="displayerror && !isPrelimDesignSelected">Required</span>
            </p>
            <div class="custom-dropzone" ngx-dropzone [multiple]="false" [accept]="' .pdf,.zip'"
              (change)="onPrelimSelect($event)" *ngIf="!isPrelimDesignSelected">
              <ngx-dropzone-label>
                <div>
                  <img class="addimage" src="../../../../../assets/add.svg">
                  <h5>Drag and drop your sales proposal here or click to browse</h5>
                </div>
              </ngx-dropzone-label>
            </div>
            <div class="row pdfselectionpreview align-items-center" *ngIf="isPrelimDesignSelected">
              <div class="col-2">
                <img *ngIf="extension == 'pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'png'" class="material-icons file-icon" src="./../assets/png.svg">
                <img *ngIf="extension == 'zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                <img *ngIf="extension == 'doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                <img *ngIf="extension == 'txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                <img
                  *ngIf="extension!== 'png' && extension !== 'pdf' && extension !== 'zip' && extension !== 'doc' && extension !== 'docx' && extension !== 'odt' && extension !== 'rtf' && extension !== 'txt'"
                  class="material-icons file-icon" src="./../assets/file.svg">

              </div>
              <div class="col-7">
                <p>{{prelimfiles[0].name}}</p>
              </div>
              <div class="col-3">
                <button class="float-right bluebutton" mat-raised-button (click)="onPrelimRemove()">Remove</button>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6">
            <p class="subtitle fullwidth">Comments</p>
            <mat-form-field appearance="fill" class="fullwidth">
              <mat-label>comments</mat-label>
              <textarea style="height: 132px;" matInput placeholder="Ex. Start typing here..."
                [formControl]="designcomments"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <button class="float-right ml-1" mat-raised-button (click)="uploadPrelimDesign()">Submit</button>
          </div>
        </div>


        <div class="row mt-5"
          *ngIf="(isUserAnalyst && this.data.prelim.status == 'reviewassigned') || (data.prelim.status == 'reviewassigned' && data.prelim.reviewassignedto.id == this.loggedInUser.id)">
          <div class="col-12 pb-5" *ngIf="prelimCriteria.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px">
              CheckList*<span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of prelimCriteria; let i = index">

                <div class="col-12">

                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback"
                        (change)="item.feedback == false ? item.feedback = true : item.feedback == true? item.feedback = false: null; onSaveCritetriaPrelimChecklist(item,i)">
                      <img src="../../../assets/message.svg" width="23px" height="20px"
                        (click)="ShowCommentCriteria(item)"
                        *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)">
                    </div>

                  </div>


                  <ng-container *ngIf="!item.feedback">
                    <div *ngFor="let comment of item.comments; let j = index;"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">

                        <div class="row">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                          <div class="col-4 d-flex justify-content-end"
                            *ngIf="loggedInUser.id==comment.createdby?.id && j==item.comments.length-1">
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/edit.svg"
                                (click)="editChecklistCommentForAnalyst(comment,i,j,item)"></button>
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/delete.svg"
                                (click)="deleteChecklistCommentPrelimChecklist(comment,i,j)"></button>
                          </div>

                          <!-- <hr /> -->
                        </div>
                        <mat-divider class="divider"></mat-divider>
                      </div>
                    </div>
                  </ng-container>


                </div>



                <div class="col-12 pl-3 mt-2"
                  *ngIf="(isciteriacommentshow && selectedCriteria.id == item.id) || (isEditChecklist && selectedCriteria.id == item.id)">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="anyalistchecklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button *ngIf="!isEditChecklist"
                        (click)="onSaveCritetriaPrelimChecklist(item,i)">Save</button>
                      <button mat-raised-button *ngIf="isEditChecklist"
                        (click)="onEditCommentsPrelimChecklist()">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="((data.prelim.status == 'designcompleted' || data.prelim.status == 'reviewpassed' || data.prelim.status == 'delivered' || (data.prelim.status=='designassigned' && !isUserDesigner) || (data.prelim.status=='reviewfailed' && !isUserDesigner) || (data.prelim.status == 'reviewassigned' && !isUserAnalyst  && data.prelim.reviewassignedto.id != this.loggedInUser.id)) && !isClient)">

          <div class="col-12 pb-5" *ngIf="prelimCriteria.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px"> CheckList
              *<span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of prelimCriteria; let i = index">


                <div class="col-12">

                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback" disabled='true'>
                      <!-- <img src="../../../assets/message.svg" width="23px" height="20px"
                                            (click)="ShowCommentCriteria(item)" *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)"> -->
                    </div>

                  </div>


                  <ng-container *ngIf="!item.feedback">
                    <div *ngFor="let comment of item.comments; let j = index;"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">
                        <div class="row">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                        </div>
                        <mat-divider class="divider"></mat-divider>
                        <!-- <div class="row">
                                                <div class="col-12" ></div>
                                                </div>   -->
                      </div>
                    </div>
                  </ng-container>


                </div>

                <div class="col-12 pl-3 mt-2" *ngIf="isciteriacommentshow && selectedCriteria.id == item.id">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="anyalistchecklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button (click)="onSaveCritetriaPrelimChecklist(item,i)">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="(isUserAnalyst && this.data.prelim.status == 'reviewassigned') || (this.data.prelim.status == 'reviewassigned' && this.data.prelim.reviewassignedto.id == this.loggedInUser.id)">
          <div *ngIf="isselfupdateprelim" class="col align-items-center">
            <p class="subtitle fullwidth">Upload Sales Proposal Design
              <span style="color: red; " *ngIf="displayerror">* Required</span>
            </p>
            <div class="custom-dropzone" ngx-dropzone [multiple]="false" (change)="onPrelimSelect($event)"
              [accept]="' .pdf,.zip'" *ngIf="!isPrelimDesignSelected">
              <ngx-dropzone-label>
                <div>
                  <img class="addimage" src="../../../../../assets/add.svg">
                  <h5>Drag and drop your sales proposal here or click to browse</h5>
                </div>
              </ngx-dropzone-label>
            </div>
            <div class="row pdfselectionpreview align-items-center" *ngIf="isPrelimDesignSelected">
              <div class="col-2">
                <img *ngIf="extension == 'pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'png'" class="material-icons file-icon" src="./../assets/png.svg">
                <img *ngIf="extension == 'zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                <img *ngIf="extension == 'doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                <img *ngIf="extension == 'txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                <img
                  *ngIf="extension!== 'png' && extension !== 'pdf' && extension !== 'zip' && extension !== 'doc' && extension !== 'docx' && extension !== 'odt' && extension !== 'rtf' && extension !== 'txt'"
                  class="material-icons file-icon" src="./../assets/file.svg">

              </div>
              <div class="col-7">
                <p>{{prelimfiles[0].name}}</p>
              </div>
              <div class="col-3">
                <button class="float-right bluebutton" mat-raised-button (click)="onPrelimRemove()">Remove</button>
              </div>
            </div>
            <button class="float-right ml-1" mat-button (click)="prelimselfUpdateCancelClick()">Cancel</button>
          </div>
          <div class="col">
            <p class="subtitle fullwidth">Issues</p>
            <div class="row subbody">
              <div class="col">
                <mat-form-field appearance="fill" class="fullwidth">
                  <mat-label>comments</mat-label>
                  <textarea class="largetextarea" matInput placeholder="Enter your issues here..."
                    [formControl]="reviewissues"></textarea>
                  <mat-error *ngIf="reviewissues.invalid">{{getErrorMessage(reviewissues)}}
                  </mat-error>
                </mat-form-field>
                <p style="color: red;font-size: smaller;" *ngIf="reviewissuesinvalid==true">Please Enter
                  issue</p>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <button class="float-right ml-1" *ngIf="!isselfupdateprelim" mat-raised-button
                  (click)="prelimreportDesignReviewFailure()">Failed</button>
                <button class="float-right" mat-raised-button
                  (click)="prelimupdateDesignReviewSuccess()">Passed</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    <mat-tab *ngIf="data.survey!=null || data.survey!=undefined">
      <ng-template matTabLabel *ngIf="isClient">
        {{userSettings?.namesurvey}}
      </ng-template>
      <ng-template matTabLabel *ngIf="!isClient">
        Survey
      </ng-template>
      <div class="container detailsdialog">
        <mat-tab-group mat-align-tabs="center">
          <mat-tab>
            <ng-template matTabLabel>
              Site Details
            </ng-template>
            <div class="row mt-3 ">
              <div class="col-6">
                <p class="subtitle fullwidth">Customer Details</p>
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Name</p>
                    <p class="contentheader">Email</p>
                    <p class="contentheader">Created By</p>
                    <p class="contentheader">Phone Number</p>
                    <p class="contentheader">Address</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue text-right">{{ data.survey?.name || defaultvalue}}</p>
                    <p class="contentvalue text-right">{{
                      data.survey?.email || defaultvalue}}</p>
                    <p class="contentvalue text-right">{{ data.survey.createdby?.firstname ||
                      defaultvalue}} {{
                      data.survey.createdby?.lastname }}</p>
                    <p class="contentvalue text-right">{{ data.survey?.phonenumber || defaultvalue
                      }}</p>
                    <p class="contentvalue text-right">{{
                      data.survey?.address || defaultvalue }}</p>
                  </div>
                </div>
              </div>
              <div class="col-6">

                <p class="subtitle fullwidth">Property Type</p>
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Type</p>
                  </div>
                  <div class="col">

                    <p class="contentvalue text-right" *ngIf="data.survey.projecttype == 'detachedbuildingorshop'">
                      Detached
                      Building or Shop</p>
                    <p class="contentvalue text-right" *ngIf="data.survey.projecttype != 'detachedbuildingorshop'">{{
                      data.survey.projecttype | titlecase }}</p>

                  </div>
                </div>

                <p class="subtitle fullwidth mt-5">Job Details</p>
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Job</p>
                    <p class="contentheader">Scheduled On</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue text-right">{{
                      genericService?.getJobTypeName(data.survey.jobtype) || defaultvalue }}</p>
                    <p class="contentvalue text-right">
                      {{genericService?.formatDateInDisplayFormat(data.survey.datetime)}}
                      {{ genericService?.formatTimeInDisplayFormat(data.survey.datetime) ||
                      defaultvalue}}</p>
                  </div>
                </div>


              </div>
              <div class="col-6 mt-5" *ngIf="data.survey.comments.length > 0"
                [ngStyle]="showComments? {'display': 'block'} : {'display': 'none'}">
                <p class="subtitle fullwidth">Comments</p>
                <div *ngFor="let comment of data.survey.comments">
                  <div class="row commentslist"
                    *ngIf="comment.createdby?.role != 3 && comment?.createdby?.role != 8 && comment?.createdby?.role != 10">
                    <p style="width: 50%;">
                      <span>&#8220;</span>{{comment.message}}<span>&#8221;</span>
                    </p>
                    <p class="pl-1 text-center" style="width: 25%;">
                      {{comment?.createdby?.firstname}}
                      {{comment?.createdby?.lastname}}
                    </p>
                    <p class="pl-1 text-right"
                      style="width: 25%; font-style: italic; color: #666666; font-weight: 500;">
                      {{ genericService.formatDateInDisplayFormat(comment.created_at) }}</p>
                  </div>
                </div>
              </div>
              <div class="col-6 align-items-center mt-5" *ngIf="data.survey.status == 'requestdeclined'">
                <p class="subtitle ">Reason</p>
                <div class="row subbody">
                  <div class="col">
                    <p class="contentvalue">{{data.survey.requestdeclinereason}}</p>
                  </div>
                </div>
              </div>
              <div class="col-6 mt-5"
                *ngIf="data.survey.status == 'outsourced' || data.survey.status == 'delivered' || data.survey.status == 'assigned' || data.survey.status == 'completed'">
                <p class="subtitle fullwidth">Assignee Details</p>
                <div class="row subbody">
                  <div class="col">
                    <p *ngIf="data.survey.status == 'assigned' || data.survey.status == 'completed'"
                      class="contentvalue">{{data.survey?.assignedto.firstname ||defaultvalue}}
                      {{data.survey?.assignedto.lastname}}</p>
                  </div>
                  <div class="col">
                    <div class="initials float-right">
                      <p *ngIf="data.survey.status == 'assigned' || data.survey.status == 'completed'">
                        {{genericService?.getInitials(data.survey.assignedto.firstname,
                        data.survey.assignedto.lastname) || defaultvalue}}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 mt-5" *ngIf="(data.survey.status == 'completed') ">
                <p class="subtitle fullwidth">Details</p>
                <div class="row subbody">
                  <div class="col">
                    <!-- <p class="contentheader">Existing Modules Brand</p>
                                <p class="contentheader">Existing Modules Model</p>
                                <p class="contentheader">Battery Backup</p> -->
                    <p class="contentheader">
                      Interconnection</p>
                    <p class="contentheader">
                      Service Feed Source</p>
                    <p class="contentheader">Roof
                      Material</p>
                    <p class="contentheader">
                      Existing Solar System</p>
                    <p class="contentheader">
                      Additional Notes</p>
                    <p class="contentheader">
                      Battery System</p>
                    <p class="contentheader">ESID</p>
                    <p class="contentheader">Meter Number</p>
                    <p class="contentheader">Location</p>
                  </div>
                  <div class="col  text-right">
                    <!-- <p class="contentvalue">{{ data.survey.modulemake.name }}</p>
                                <p class="contentvalue">{{ data.survey.modulemodel.name }}</p>
                                <p class="contentvalue">{{ data.survey.batterybackup | titlecase }}</p> -->
                    <p class="contentvalue">{{
                      genericService?.getInterconnectionName(data.survey.interconnection) ||
                      defaultvalue}}
                    </p>
                    <p class="contentvalue">{{
                      ( data.survey?.servicefeedsource |
                      titlecase) || defaultvalue}} </p>
                    <p class="contentvalue">{{
                      data.survey.roofmaterial?.name || defaultvalue }}</p>
                    <p class="contentvalue">{{
                      data.survey?.existingsolarsystem || defaultvalue }}</p>
                    <p class="contentvalue">{{
                      data.survey?.additionalnotes || defaultvalue }}</p>
                    <p class="contentvalue">{{
                      data.survey?.batterysystem ||defaultvalue}}</p>
                    <p class="contentvalue">{{ data.survey?.esid || defaultvalue
                      }}</p>
                    <p class="contentvalue">{{ data.survey?.meternumber || defaultvalue }}
                    </p>
                    <a class="contentvalue"
                      href="https://maps.google.com/?q={{data.survey.latitude}},{{data.survey.longitude}}"
                      target="_blank" (click)="$event.stopPropagation()">{{ data.survey?.latitude
                      || defaultvalue }} {{data.survey?.longitude }}
                    </a>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 mt-5"
                *ngIf="(data.survey.status == 'completed') && (data.survey.hoaattachments?.length!=0  || data.survey.hoadetails !=null)">
                <p class="subtitle fullwidth">HOA Guidelines</p>
                <div class="row">
                  <div class="col">
                    <p class="contentheader" *ngIf="data.survey.hoadetails !=null">HOA Details
                    </p>
                  </div>
                  <div class="col text-right">
                    <p class="contentvalue" *ngIf="data.survey.hoadetails !=null">{{
                      data.survey.hoadetails }}</p>

                  </div>

                </div>
                <div class="row subbody list-border" *ngFor="let hoattachment of data.survey.hoaattachments">
                  <div class="col-2">
                    <p class="contentheader"><img *ngIf="hoattachment.ext == '.pdf'" class="material-icons file-icon"
                        src="./../assets/pdf.svg">
                      <img *ngIf="hoattachment.ext == '.png'" class="material-icons file-icon"
                        src="./../assets/png.svg">
                      <img *ngIf="hoattachment.ext == '.zip'" class="material-icons file-icon"
                        src="./../assets/zip.svg">
                      <img *ngIf="hoattachment.ext == '.doc'" class="material-icons file-icon"
                        src="./../assets/doc.svg">
                      <img *ngIf="hoattachment.ext == '.docx'" class="material-icons file-icon"
                        src="./../assets/doc.svg">
                      <img *ngIf="hoattachment.ext == '.odt'" class="material-icons file-icon"
                        src="./../assets/pdf.svg">
                      <img *ngIf="hoattachment.ext == '.rtf'" class="material-icons file-icon"
                        src="./../assets/rtf.svg">
                      <img *ngIf="hoattachment.ext == '.txt'" class="material-icons file-icon"
                        src="./../assets/txt.svg">
                      <img
                        *ngIf="hoattachment.ext !== '.png' && hoattachment.ext !== '.pdf' && hoattachment.ext !== '.zip' && hoattachment.ext !== '.doc' && hoattachment.ext !== '.docx' && hoattachment.ext !== '.odt' && hoattachment.ext !== '.rtf' && hoattachment.ext !== '.txt'"
                        class="material-icons file-icon" src="./../assets/file.svg">
                    </p>
                  </div>
                  <div class="col-10">
                    <a href="{{hoattachment.url}}" target="_blank" class="contentvalue float-right">{{ hoattachment.name
                      | uppercase
                      }}</a>

                  </div>
                </div>
              </div>

              <div class="col-6 mt-5" *ngIf="isClient && this.data.survey.status == 'reviewfailed'">
                <p class="subtitle">Issues</p>
                <div class="row subbody">
                  <div class="col">
                    <p>{{this.data.survey.reviewissues}}</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-12 mt-5"
                *ngIf="data.survey.raiserequestreason != (null || '') && showRaiseRequestData">
                <p class="subtitle fullwidth">Raise Request Reason</p>
                <div class="row subbody">
                  <div class="col d-flex justify-content-between">
                    <p class="contentvalue" style="width: 50%;">{{data.survey.raiserequestreason}}</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-12 mt-5"
                *ngIf="data.survey?.raiserequestattachment?.length > 0 &&  showRaiseRequestData">
                <p class="subtitle fullwidth">Raise Request Attachment</p>
                <div class="row subbody list-border" *ngFor="let attachmentfile of data.survey.raiserequestattachment">
                  <div class="col-2">
                    <p class="contentheader">
                      <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                        src="./../assets/pdf.svg">
                      <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                        src="./../assets/png.svg">
                      <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                        src="./../assets/zip.svg">
                      <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                        src="./../assets/doc.svg">
                      <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                        src="./../assets/doc.svg">
                      <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                        src="./../assets/pdf.svg">
                      <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                        src="./../assets/rtf.svg">
                      <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                        src="./../assets/txt.svg">
                      <img
                        *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                        class="material-icons file-icon" src="./../assets/file.svg">
                    </p>
                  </div>
                  <div class="col-10">
                    <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                      attachmentfile.name
                      | uppercase }}</a>
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>
          <mat-tab label="Gallery" *ngIf="(data.survey.status == 'completed') ">

            <div class="row mt-3 slidecarouselrow" *ngIf="data.survey.mspimages.length > 0">
              <p class="subtitle fullwidth">MSP</p>
              <div class="col-5">
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">MSP location</p>
                    <p class="contentheader">MSP/BUS Rating</p>
                    <p class="contentheader">Main Breaker location in MSP</p>
                    <p class="contentheader">Main Breaker size</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ (data.survey?.msplocation | titlecase) ||
                      defaultvalue}}
                    </p>
                    <p class="contentvalue">{{data.survey?.msprating || defaultvalue}}
                    </p>
                    <p class="contentvalue">{{ (data.survey?.mspbreaker | titlecase)
                      || defaultvalue}}
                    </p>
                    <p class="contentvalue">{{data.survey?.mainbreakersize || defaultvalue}}
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of mspimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of mspimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb">
                                </p> -->
              </div>
            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.existingsubpanelimages.length > 0">
              <p class="subtitle fullwidth">Existing sub Panel Images</p>
              <div class="col-5">
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Subpanel Location </p>
                    <p class="contentheader">Subpanel Rating </p>
                    <p class="contentheader">Subpanel Main Breaker size </p>
                    <p class="contentheader">Subpanel Breaker </p>
                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ (data.survey?.subpanellocation | titlecase) ||
                      defaultvalue}}
                    </p>
                    <p class="contentvalue">{{data.survey?.subpanelrating || defaultvalue}}
                    </p>
                    <p class="contentvalue">{{ data.survey?.subpanelmainbreakersize
                      ||defaultvalue}}
                    </p>
                    <p class="contentvalue">{{ (data.survey?.subpanelbreaker |titlecase)
                      ||defaultvalue}}
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of existingsubpanelimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'existingsubpanelimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of existingsubpanelimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'existingsubpanelimages'">
                                </p> -->
              </div>

            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.utilitymeterimages.length > 0">
              <p class="subtitle fullwidth">Utility Meter</p>
              <div class="col-5">
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Utility meter is</p>

                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ (data.survey?.utilitymeter | titlecase) ||
                      defaultvalue}}ed
                    </p>

                  </div>
                </div>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of utilitymeterimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'utilitymeterimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of utilitymeterimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'utilitymeterimages'">
                                </p> -->
              </div>
            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.pvinverterimages.length > 0">
              <p class="subtitle fullwidth">PV Inverter</p>
              <div class="col-5">
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">PV Inverter location</p>
                    <p class="contentheader">Inverter manufacturer</p>
                    <p class="contentheader">Inverter model</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ (data.survey?.pvinverterlocation | titlecase) ||
                      defaultvalue}}
                    </p>

                    <p class="contentvalue">{{ data.survey.invertermake?.name || defaultvalue }}
                    </p>
                    <p class="contentvalue">{{
                      data.survey.invertermodel?.name || defaultvalue }}
                    </p>
                  </div>
                </div>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of pvinverterimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'pvinverterimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of pvinverterimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'pvinverterimages'">
                                </p> -->
              </div>
            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.pvmeterimages.length > 0">
              <p class="subtitle fullwidth">PV Meter</p>
              <div class="col-5">
                <p class="surveyprocesscardsubtext">PV Meter Wide Angle Shot</p>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of pvmeterimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'pvmeterimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of pvmeterimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'pvmeterimages'">
                                </p> -->
              </div>
            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.acdisconnectimages.length > 0">
              <p class="subtitle fullwidth">Ac Disconnect</p>
              <div class="col-5">
                <p class="surveyprocesscardsubtext">AC Disconnect Wide Angle Shot</p>
                <p class="surveyprocesscardsubtext">AC Disconnect Zoom Shot</p>
              </div>
              <div class="col-7">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of acdisconnectimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'acdisconnectimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of acdisconnectimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'acdisconnectimages'">
                                </p> -->
              </div>
            </div>
            <div class="row ">
              <div class="col" *ngIf="data.survey.roofimages.length > 0">
                <p class="subtitle fullwidth">Roof Images</p>
                <div class="row subbody">
                  <div class="col-3">
                    <p class="contentheader">Roof tilt is</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ data.survey?.rooftilt || defaultvalue
                      }}
                    </p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of roofimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'roofimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of roofimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'roofimages'">
                                </p> -->
              </div>
              <div class="col" *ngIf="data.survey.roofdimensionimages.length > 0">
                <p class="subtitle fullwidth">Roof Dimensions </p>
                <p class="surveyprocesscardsubtext"></p>
                <div class="row" style="padding-top: 19px;">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of roofdimensionimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'roofdimensionimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of roofdimensionimages;index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'roofdimensionimages'">
                                </p> -->
              </div>
            </div>
            <div class="row">
              <div class="col" *ngIf="data.survey.obstaclesimages.length > 0">
                <p class="subtitle fullwidth">Obstacles Images</p>
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of obstaclesimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'obstaclesimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of obstaclesimages ; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'obstaclesimages'">
                                </p> -->
              </div>
              <div class="col" *ngIf="data.survey.obstaclesdimensionsimages.length > 0">
                <p class="subtitle fullwidth">Obstacles Dimensions Images</p>
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of obstaclesdimensionsimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'obstaclesdimensionsimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of obstaclesdimensionsimages ; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'obstaclesdimensionsimages'">
                                </p> -->
              </div>
            </div>

            <div class="row">

              <div class="col" *ngIf="data.survey.utilitybillfront != null">
                <p class="subtitle fullwidth">Utility Bill Front</p>
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of utilitybillfront; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'utilitybillfront'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img style="width: 80px" *ngFor="let item of utilitybillfront ; index as i"
                                        [lightbox]="i" [src]="item.data.thumb" [gallery]="'utilitybillfront'">
                                </p> -->
              </div>

              <div class="col" *ngIf="data.survey.utilitybillback != null">
                <p class="subtitle fullwidth">Utility Bill Back</p>
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of utilitybillback; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'utilitybillback'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img style="width: 80px" *ngFor="let item of utilitybillback ; index as i"
                                        [lightbox]="i" [src]="item.data.thumb" [gallery]="'utilitybillback'">
                                </p> -->
              </div>

            </div>


            <div class="row slidecarouselrow" *ngIf="data.survey.atticimages.length > 0">
              <p class="subtitle fullwidth">Attic Images</p>
              <div class="col-5">
                <div class="row subbody">
                  <div class="col">
                    <p class="contentheader">Framing</p>
                    <p class="contentheader">Framing size </p>
                    <p class="contentheader">Distance b/w two rafts</p>
                  </div>
                  <div class="col">
                    <p class="contentvalue">{{ data.survey?.framing || defaultvalue
                      }}
                    </p>
                    <p class="contentvalue">{{ data.survey?.framingsize || defaultvalue
                      }}
                    </p>
                    <p class="contentvalue">{{
                      data.survey?.distancebetweentworafts || defaultvalue
                      }} inches
                    </p>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="row">
                  <div class="col-3 appliancescontainers d-flex justify-content-center"
                    *ngFor="let item of atticimages; index as i">
                    <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'atticimages'">
                    <p class="imagetitle mb-0">
                      {{item.data.name}}
                    </p>
                  </div>
                </div>
                <!-- <p class="containers">
                                    <img *ngFor="let item of atticimages; index as i" [lightbox]="i"
                                        [src]="item.data.thumb" [gallery]="'atticimages'">
                                </p> -->
              </div>
            </div>
            <div class="row slidecarouselrow" *ngIf="data.survey.appliancesimages.length > 0">
              <p class="subtitle fullwidth">Appliances Images</p>
              <div class="row">
                <div class="col-3 appliancescontainers" *ngFor="let item of appliancesimages; index as i">
                  <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'appliancesimages'">
                  <p class="imagetitle">
                    {{item.data.name}}
                  </p>
                </div>
              </div>
            </div>

            <div class="row slidecarouselrow" *ngIf="data.survey.groundimages.length > 0">
              <p class="subtitle fullwidth">Ground Images</p>
              <div class="row">
                <div class="col-3 appliancescontainers" *ngFor="let item of groundimages; index as i">
                  <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'groundimages'">
                  <p class="imagetitle">
                    {{item.data.name}}
                  </p>
                </div>
              </div>
            </div>

            <div class="row slidecarouselrow" *ngIf="data.survey.solarpanelsimages.length > 0">
              <p class="subtitle fullwidth">Solar Panel Images</p>
              <div class="row">
                <div class="col-3 appliancescontainers" *ngFor="let item of solarpanelsimages; index as i">
                  <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'solarpanelsimages'">
                  <p class="imagetitle">
                    {{item.data.name}}
                  </p>
                </div>
              </div>
            </div>



          </mat-tab>
        </mat-tab-group>
      </div>
    </mat-tab>
    <mat-tab *ngIf="data.permit!=null || data.permit!=undefined">
      <ng-template matTabLabel *ngIf="!this.genericService.specificclient && isClient">
        {{userSettings?.namepermit}}
      </ng-template>
      <ng-template matTabLabel *ngIf="!isClient">
        Permit
      </ng-template>
      <ng-template matTabLabel *ngIf="this.genericService.specificclient && isClient">
        Design
      </ng-template>
      <div class="container detailsdialog">
        <div class="row mt-3">
          <div class="col-sm-6 col-12">
            <p class="subtitle fullwidth">Customer and Site Details</p>
            <div class="row subbody">
              <div class="col-6">
                <p class="contentheader">Company</p>
                <p class="contentheader">Name</p>
                <p class="contentheader">Email</p>
                <p class="contentheader">Created By</p>
                <p class="contentheader">Phone Number</p>
                <p class="contentheader" *ngIf="data.permit.monthlybill !== null">Annual Units</p>
                <p class="contentheader" *ngIf="data.permit.solarcapacity != null">Solar Capacity</p>
                <p class="contentheader" *ngIf="data.permit.address != null">Address</p>
              </div>
              <div class="col-6 ">
                <p class="contentvalue text-right">{{ data.permit.company }}</p>
                <p class="contentvalue text-right">{{ data.permit.name }}</p>
                <p style="word-wrap: break-word;" class="contentvalue text-right">{{ data.permit.email
                  }}</p>
                <p class="contentvalue text-right">{{ data.permit.createdby.firstname }} {{
                  data.permit.createdby.lastname }}</p>
                <p style="word-wrap: break-word;" class="contentvalue text-right">{{
                  data.permit.phonenumber }}</p>
                <p class="contentvalue text-right" *ngIf="data.permit.monthlybill != null">{{
                  data.permit.monthlybill }} kW</p>
                <p class="contentvalue text-right" *ngIf="data.permit.solarcapacity != null">{{
                  data.permit.solarcapacity }} kW</p>
                <p style="word-wrap: break-word;" class="contentvalue text-right" *ngIf="data.permit.address != null">{{
                  data.permit.address }}</p>
                <p class="contentvalue text-right" *ngIf="data.permit.address == null">No address found
                </p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12">
            <p class="subtitle fullwidth">Job Details</p>
            <div class="row subbody">
              <div class="col-4">
                <p class="contentheader">Property</p>
                <p class="contentheader">Job Type</p>
                <p class="contentheader" *ngIf="data.permit.mpurequired !=null">MPU Required</p>
                <p class="contentheader">Utility Name</p>
                <p class="contentheader">AHJ</p>
                <p class="contentheader">ESI ID</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ data.permit.projecttype | titlecase }}</p>
                <p class="contentvalue text-right" *ngIf="data.permit.jobtype!='pvbattery'">{{
                  data.permit.jobtype |
                  titlecase }}</p>
                <p class="contentvalue text-right" *ngIf="data.permit.jobtype=='pvbattery'">PV+Battery
                </p>
                <p class="contentvalue text-right" *ngIf="data.permit.mpurequired !=null && !data.permit.mpurequired">No
                </p>
                <p class="contentvalue text-right" *ngIf="data.permit.mpurequired !=null && data.permit.mpurequired">Yes
                </p>
                <p class="contentvalue text-right">{{data.permit.utility?.name || defaultvalue}}</p>
                <p class="contentvalue text-right">
                  {{data.permit.ahj?.name || defaultvalue}}</p>
                <p class="contentvalue text-right">
                  {{data.permit?.esiid|| defaultvalue}}</p>
              </div>
            </div>
          </div>
          <!-- <div class="col-sm-6 col-12 mt-5">
                        <p class="subtitle fullwidth">Module Details</p>
                        <div class="row subbody">
                            <div class="col-4">
                                <p class="contentheader">Make</p>
                                <p class="contentheader">Model</p>
                               
                            </div>
                            <div class="col">
                                <p class="contentvalue text-right" *ngIf="data.permit.solarmake?.name != null">{{ data.permit.solarmake?.name || defaultvalue}}</p>
                                <p class="contentvalue text-right" *ngIf="data.permit.newmodulemake != null">{{ data.permit.newmodulemake || defaultvalue}}</p>
                                <mat-select *ngIf="(data.permit.solarmake?.name == null && data.permit.newmodulemake == null)&& (isUserDesigner || isUserAnalyst) " style="background-color: white; width: 90%; float:right;margin-bottom: 5px;" [formControl]="modulemakePermit" #singleSelect placeholder= "  Module Make">
                                    <mat-option>
                                      <ngx-mat-select-search [formControl]="modulemakefilterPermit"  placeholderLabel="Search">
                                      </ngx-mat-select-search>
                                    </mat-option>
                                    <mat-option (onSelectionChange)="fetchModuleModelsDataPermit($event,modulemake)" *ngFor="let modulemake of filteredModuleMakesPermit | async" [value]="modulemake.id"
                                     >{{modulemake.name}}</mat-option>
                                
                                  </mat-select>
                                <p class="contentvalue text-right" *ngIf="data.permit.solarmodel?.name != null">{{ data.permit.solarmodel?.name || defaultvalue}}</p>
                                <p class="contentvalue text-right" *ngIf="data.permit.newmodulemade != null">{{ data.permit.newmodulemade || defaultvalue}}</p>
                                <mat-select *ngIf="(data.permit.solarmodel?.name == null && data.permit.newmodulemade == null) && (isUserDesigner || isUserAnalyst) " style="background-color: white; width: 90%; float:right;margin-bottom: 5px;" [formControl]="modulemodelPermit" #singleSelect placeholder="  Module Model"
                                >
                                   <mat-option>
                                     <ngx-mat-select-search [formControl]="modulemodelfilterPermit" placeholderLabel="Search">
                                     </ngx-mat-select-search>
                                   </mat-option>
                                   <mat-option *ngFor="let modulemodel of filteredModuleModelsPermit | async" [value]="modulemodel.id"
                                   >{{modulemodel.name}}</mat-option>
                                 </mat-select>
                               
                            </div>
                            
                        </div>
                        <div class="d-flex justify-content-between">
                            <p class="contentheader">Module Count</p>
                            <input *ngIf="((data.permit.solarmake?.name == null && data.permit.newmodulemake == null) || (data.permit.solarmodel?.name == null && data.permit.newmodulemade == null)) && (isUserDesigner || isUserAnalyst)  ; else invcount " matInput style="background-color: white;width: 40%;" type="text" (keypress)="numberOnly($event)" autocomplete="off" maxlength="7" min="1" matInput [formControl]="modulecountPermit" >
                            <ng-template #invcount><p  class="contentvalue text-right">{{ data.permit.modulecount || defaultvalue}}</p></ng-template>
                         
                        </div>
                    </div>
                    <div class="col-sm-6 col-12 mt-5">
                        <p class="subtitle fullwidth">Inverter Details</p>
                        <div class="d-flex justify-content-between" style="margin-bottom: 5px;">
                            <p class="contentheader" >Make</p>
                            <p class="contentvalue text-right" *ngIf="data.permit.invertermake?.name != null">{{ data.permit.invertermake?.name || defaultvalue}}
                            </p>
                            <p class="contentvalue text-right" *ngIf="data.permit.newinvertermake != null">{{ data.permit.newinvertermake || defaultvalue}}</p>
                            <mat-select *ngIf="(data.permit.invertermake?.name == null && data.permit.newinvertermake == null)&& (isUserDesigner || isUserAnalyst) " style="background-color: white; width: 40%;" [formControl]="invertermakePermit" #singleSelect placeholder= "  Inverter Make">
                                <mat-option>
                                  <ngx-mat-select-search [formControl]="invertermakefilterPermit"  placeholderLabel="Search">
                                  </ngx-mat-select-search>
                                </mat-option>
                                <mat-option (onSelectionChange)="fetchInverterModelsDataPermit($event,invertermake)" *ngFor="let invertermake of filteredInverterMakesPermit | async" [value]="invertermake.id"
                                 >{{invertermake.name}}</mat-option>
                            
                              </mat-select>
                        </div>
                        <div class="d-flex justify-content-between" style="margin-bottom: 5px;">
                            <p class="contentheader">Model</p>
                            <p class="contentvalue text-right" *ngIf="data.permit.invertermodel?.name != null">{{ data.permit.invertermodel?.name || defaultvalue}}
                            </p>
                            <p class="contentvalue text-right" *ngIf="data.permit.newinvertermade != null">{{ data.permit.newinvertermade || defaultvalue}}</p>
                            <mat-select *ngIf="(data.permit.invertermodel?.name == null && data.permit.newinvertermade == null) && (isUserDesigner || isUserAnalyst) "  style="background-color: white; width: 40%;" [formControl]="invertermodelPermit" #singleSelect placeholder="  Inverter Model"
                            >
                               <mat-option>
                                 <ngx-mat-select-search [formControl]="invertermodelfilterPermit" placeholderLabel="Search">
                                 </ngx-mat-select-search>
                               </mat-option>
                               <mat-option *ngFor="let invertermodel of filteredInverterModelsPermit | async" [value]="invertermodel.id"
                               >{{invertermodel.name}}</mat-option>
                             </mat-select>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p class="contentheader">Inverters Count</p>
                            
                            <input *ngIf="((data.permit.invertermodel?.name == null && data.permit.newinvertermade == null) || (data.permit.invertermake?.name == null && data.permit.newinvertermake == null)) && (isUserDesigner || isUserAnalyst) ; else invcount " matInput style="background-color: white;width: 40%;" type="text" (keypress)="numberOnly($event)" autocomplete="off" maxlength="7" min="1" matInput [formControl]="inverterscountPermit" >
                            <ng-template #invcount><p  class="contentvalue text-right">{{ data.permit.inverterscount}}</p></ng-template>
                        </div>
                    </div> -->









          <!-- ----------------------------------------------------------------  -->


          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Module Details</p>
            <ng-container>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Make</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.permit.solarmake?.name != null">{{ data.permit.solarmake?.name || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.permit.newmodulemake != null">{{ data.permit.newmodulemake || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(data.permit.solarmake?.name == null && data.permit.newmodulemake == null)&& (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <mat-select
                    *ngIf="(data.permit.solarmake?.name == null && data.permit.newmodulemake == null)&& (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" [formControl]="modulemakePermit"
                    #singleSelect placeholder="  Module Make">
                    <mat-option>
                      <ngx-mat-select-search [formControl]="modulemakefilterPermit" placeholderLabel="Search">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option (onSelectionChange)="fetchModuleModelsDataPermit($event,modulemake)"
                      *ngFor="let modulemake of filteredModuleMakesPermit | async" [value]="modulemake.id">
                      {{modulemake.name}}</mat-option>

                  </mat-select>
                </div>
                <mat-error [hidden]="permitdisplayerror" *ngIf="modulemakePermit.invalid" class="error"
                  style="margin-left: 50%;">{{getErrorMessage(modulemakePermit)}}</mat-error>
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Model</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.permit.solarmodel?.name != null">{{ data.permit.solarmodel?.name || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="data.permit.newmodulemade != null">{{ data.permit.newmodulemade || defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(data.permit.solarmodel?.name == null && data.permit.newmodulemade == null) && (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <mat-select
                    *ngIf="(data.permit.solarmodel?.name == null && data.permit.newmodulemade == null) && (isUserDesigner || isUserAnalyst) "
                    style="background-color: white;width: 94%;padding-left: 5px;" [formControl]="modulemodelPermit"
                    #singleSelect placeholder="  Module Model">
                    <mat-option>
                      <ngx-mat-select-search [formControl]="modulemodelfilterPermit" placeholderLabel="Search">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let modulemodel of filteredModuleModelsPermit | async" [value]="modulemodel.id"
                      (onSelectionChange)="setmodulemodelidpermit(modulemodel)">
                      {{modulemodel.name}}</mat-option>
                  </mat-select>
                </div>
                <mat-error [hidden]="permitdisplayerror" *ngIf="modulemodelPermit.invalid" class="error"
                  style="margin-left: 50%;">{{getErrorMessage(modulemodelPermit)}}</mat-error>
              </div>
              <div class="d-flex justify-content-between row">
                <div class="col-6">
                  <p class="contentheader">Module Count</p>
                </div>
                <div class="col-6" style="padding: 0px;">
                  <input
                    *ngIf="((data.permit.solarmake?.name == null && data.permit.newmodulemake == null) || (data.permit.solarmodel?.name == null && data.permit.newmodulemade == null)) && (isUserDesigner || isUserAnalyst)  ; else mdcount "
                    matInput style="background-color: white;width: 94%;padding-left: 5px;" type="text"
                    (keypress)="numberOnly($event)" autocomplete="off" maxlength="7" min="1" matInput
                    [formControl]="modulecountPermit">
                  <ng-template #mdcount>
                    <p style="padding-right: 6%;float: right;">{{ data.permit.modulecount }}</p>
                  </ng-template>
                </div>
                <mat-error [hidden]="permitdisplayerror" *ngIf="modulecountPermit.invalid" class="error"
                  style="margin-left: 50%;">{{getErrorMessage(modulecountPermit)}}</mat-error>
              </div>
            </ng-container>
          </div>
          <div class="col-12  col-sm-6 mt-5">
            <p class="subtitle fullwidth">Inverter Details</p>
            <ng-container *ngFor="let inverters of data.permit?.designinverters; let i = index">
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Make</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.invertermake?.name != null &&  inverters.invertermake?.name != 'Others'">{{
                    inverters.invertermake?.name ||
                    defaultvalue}}
                  </p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(inverters.invertermake?.name == null ) && (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <mat-select
                    *ngIf="(inverters.invertermake?.name == null || inverters.invertermake?.name == 'Others') && (isUserDesigner || isUserAnalyst) "
                    (selectionChange)="fetchInverterModelsDataPermit($event.value,i)"
                    style="background-color: white; width: 94%;padding-left: 5px;" #singleSelect
                    placeholder="  Inverter Make">
                    <input matInput placeholder="Search here" style="height: 29px;padding-left: 10px;font-size: 11px !important;
                    " (keyup)="searchinvertermodels($event)" />
                    <mat-option *ngFor="let invertermake of invertermakesPermit | filterBy: searchTerm;"
                      [value]="invertermake">{{invertermake.name}}</mat-option>
                  </mat-select>
                </div>
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Model</p>
                </div>
                <div class="col-6" style="padding:0px">
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.invertermodel?.name != null &&  inverters.invertermodel?.name != 'Others'">{{
                    inverters.invertermodel?.name
                    || defaultvalue}}
                  </p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="inverters.newinvertermade != null">{{inverters.newinvertermade ||
                    defaultvalue}}</p>
                  <p class="contentvalue text-right" style="padding-right: 6%;"
                    *ngIf="(inverters.invertermodel?.name == null ) && (!isUserDesigner && !isUserAnalyst) ">
                    {{ defaultvalue}}</p>
                  <mat-select
                    *ngIf="(inverters.invertermodel?.name == null || inverters.invertermodel?.name == 'Others') && (isUserDesigner || isUserAnalyst) "
                    style="background-color: white; width: 94%;padding-left: 5px;" #singleSelect
                    placeholder="  Inverter Model">
                    <input matInput placeholder="Search here" style="height: 29px;padding-left: 10px;font-size: 11px !important;
                    " (keyup)="searchinvertermodels($event)" />
                    <mat-option (onSelectionChange)="setInverterModelValue($event,invertermodel,i)"
                      *ngFor="let invertermodel of inverters.invertermodels | filterBy: searchTerm;"
                      [value]="invertermodel.name">{{invertermodel.name}}</mat-option>
                  </mat-select>
                </div>
                <!--  <mat-error [hidden]="permitdisplayerror" *ngIf="inverters.invertermodelcontrol.invalid" class="error" style="margin-left: 50%;">{{getErrorMessage(inverters.invertermodelcontrol)}}</mat-error> -->
              </div>
              <div class="d-flex justify-content-between row" style="margin-bottom: 5px;">
                <div class="col-6">
                  <p class="contentheader">Inverters Count</p>
                </div>
                <div class="col-6" style="padding: 0px;">
                  <input
                    *ngIf="(inverters.invertermodel?.name == null || inverters.invertermake?.name == null) && (isUserDesigner || isUserAnalyst) ; else invcount "
                    matInput style="background-color: white;width: 94%;padding-left: 5px;" type="text"
                    (keypress)="numberOnly($event)" autocomplete="off" maxlength="7" matInput
                    (keyup)="setInverterscount($event,i)" [value]="inverters.inverterscount">
                  <ng-template #invcount>
                    <p style="padding-right: 6%;float: right;"> {{inverters.inverterscount}} </p>
                  </ng-template>
                </div>
              </div>
            </ng-container>
            <mat-error [hidden]="permitdisplayerror" class="error" style="margin-left: 50%;">Please enter any
              value in all fields</mat-error>
          </div>

          <div class="col-12 mt-5"
            *ngIf="(data.permit?.solarmake == null || data.permit?.solarmodel == null || saveinverters )&& (isUserDesigner || isUserAnalyst)">
            <button mat-raised-button (click)="savepermitmodels()"
              style="line-height: 25px !important; display:flex; justify-content:center;float: right;">Save</button>
          </div>

          <div class="col-sm-6 col-12 mt-5">
            <p class="subtitle fullwidth">Construction Details</p>
            <div class="row subbody">
              <div class="col-4">
                <p class="contentheader">New Construction</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{
                  genericService?.getBooleanValue(data.permit.newconstruction) || defaultvalue }}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.permit.newconstruction && data.permit.architecturaldesign.length > 0">
            <p class="subtitle fullwidth">Architectural Design</p>
            <div class="row subbody list-border">
              <p class="image-container" *ngFor="let designfile of permitarchitecturefile;let i = index">
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.pdf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/pdf.svg" width="70px" height="70px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.zip'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/zip.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.doc'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.docx'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.odt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/odt.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.rtf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/rtf.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="architecturehoverIdx = i"
                  (mouseleave)="architecturehoverIdx = -1" href="{{ designfile.data.thumb }}" target="_blank"
                  *ngIf="designfile.data.ext == '.txt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span><img src="../../../assets/file.svg" width="70px" height="70px" /></a>


                <a style="position: relative;" *ngIf="
                designfile.data.ext != '.pdf' &&
                designfile.data.ext != '.zip' &&
                designfile.data.ext != '.doc' &&
                designfile.data.ext != '.docx' &&
                designfile.data.ext != '.odt' &&
                designfile.data.ext != '.rtf' &&
                designfile.data.ext != '.txt'
              " (mouseenter)="architecturehoverIdx = i" (mouseleave)="architecturehoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': architecturehoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(designfile)" />
                  </span>
                  <img class="material-icons attachment-img" [gallery]="'permitarchitecturefile'" [lightbox]="i"
                    [src]="designfile.data.thumb" width="95%" height="95%" />
                </a>

              </p>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5">
            <p class="subtitle fullwidth">Mounting Details</p>
            <div class="row subbody">
              <div class="col-4">
                <p class="contentheader">Mounting</p>
                <p class="contentheader"
                  *ngIf="data.permit.mountingtype == 'roof' || data.permit.mountingtype == 'both'">
                  Roof</p>
                <p class="contentheader"
                  *ngIf="data.permit.mountingtype == 'ground' || data.permit.mountingtype == 'both'">
                  Tilt&nbsp;for&nbsp;groundmount&nbsp;system</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ (data.permit?.mountingtype | titlecase )||
                  defaultvalue}}</p>
                <p class="contentvalue text-right"
                  *ngIf="data.permit.mountingtype == 'roof' || data.permit.mountingtype == 'both'">
                  {{ data.permit.rooftype | titlecase}}</p>
                <p class="contentvalue text-right"
                  *ngIf="data.permit.mountingtype == 'ground' || data.permit.mountingtype == 'both'">
                  {{ data.permit.tiltofgroundmountingsystem }}</p>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6  mt-5" *ngIf="data.permit.attachments.length > 0">
            <p class="subtitle fullwidth">Attachments</p>
            <div class="row subbody list-border pl-3">
              <p class="image-container" *ngFor="let attachmentfile of permitAttachments;let i = index">
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.pdf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/pdf.svg" width="70px" height="70px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.zip'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/zip.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.doc'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.docx'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/doc.svg" width="70px" height="95px" /></a>

                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.odt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/odt.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.rtf'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/rtf.svg" width="70px" height="95px" /></a>
                <a style="position: relative;" (mouseenter)="attachmenthoverIdx = i"
                  (mouseleave)="attachmenthoverIdx = -1" href="{{ attachmentfile.data.thumb }}" target="_blank"
                  *ngIf="attachmentfile.data.ext == '.txt'">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span><img src="../../../assets/file.svg" width="70px" height="70px" /></a>


                <a style="position: relative;" *ngIf="
                attachmentfile.data.ext != '.pdf' &&
                attachmentfile.data.ext != '.zip' &&
                attachmentfile.data.ext != '.doc' &&
                attachmentfile.data.ext != '.docx' &&
                attachmentfile.data.ext != '.odt' &&
                attachmentfile.data.ext != '.rtf' &&
                attachmentfile.data.ext != '.txt'
              " (mouseenter)="attachmenthoverIdx = i" (mouseleave)="attachmenthoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': attachmenthoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 25px;width: 25px;"
                      (click)="downloadSingleFile(attachmentfile)" />
                  </span>
                  <img class="material-icons attachment-img" [gallery]="'permitAttachments'" [lightbox]="i"
                    [src]="attachmentfile.data.thumb" width="95%" height="95%" />
                </a>

              </p>
              <!-- <div class="col-4">
                                <p class="contentheader" *ngFor="let attachmentfile of permitAttachments">
                                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                                        src="./../assets/png.svg">
                                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                                        src="./../assets/zip.svg">
                                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                                        src="./../assets/rtf.svg">
                                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                                        src="./../assets/txt.svg">
                                    <img *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                                        class="material-icons file-icon" src="./../assets/file.svg">
                                </p>
                            </div>
                            <div class="col-8">
                                <a href="{{attachmentfile.url}}" target="_blank" class=" contentvalue float-right">{{
                                    attachmentfile.name |
                                    uppercase }}</a>
                            </div> -->
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="((data.permit.status == 'designcompleted' || data.permit.status == 'reviewassigned' || data.permit.status == 'reviewpassed' || data.permit.status == 'reviewfailed' || data.permit.status == 'delivered' || (data.permit.status == 'requestdeclined' && data.permit.permitdesign != null) || (data.permit.status == 'requestaccepted' && data.permit.unhold && data.permit.permitdesign != null) || data.permit.isinrevisionstate) && !isClient) || (data.permit.status == 'delivered' && isClient)">
            <p *ngIf="!this.genericService.specificclient" class="subtitle fullwidth">Permit Design</p>
            <p *ngIf="this.genericService.specificclient" class="subtitle fullwidth"> Design</p>
            <div class="d-flex justify-content-between">
              <img src="../../../assets/pdf.svg" width="60px" height="60px">
              <a href="{{data.permit.permitdesign.url}}" target="_blank" class="contentvalue"
                style="margin: auto 0px;">{{data.permit.permitdesign.name}}</a>
            </div>
            <button class="float-right"
              *ngIf="(isUserAnalyst && data.permit.status == 'reviewassigned')||(data.permit.status == 'reviewassigned' && data.permit.reviewassignedto.id == this.loggedInUser.id)"
              mat-raised-button (click)="isselfupdatepermit = !isselfupdatepermit">Self Update
            </button>
            <!-- <div class="row subbody">
                            <div class="col">
                                <p class="contentheader">View File</p>
                            </div>
                            <div class="col">
                                <a href="{{data.permit.permitdesign.url}}" target="_blank"
                                    class="contentvalue float-right">{{
                                    data.permit.permitdesign.name | titlecase }}</a>
                                <button class="float-right"
                                    *ngIf="(isUserAnalyst && data.permit.status == 'reviewassigned')||(data.permit.status == 'reviewassigned' && data.permit.reviewassignedto.id == this.loggedInUser.id)"
                                    mat-raised-button (click)="isselfupdatepermit = !isselfupdatepermit">Self
                                    Update</button>
                            </div>
                        </div> -->
          </div>
          <div class="col-sm-6 col-12 mt-5" *ngIf="data.permit.comments.length > 0"
            [ngStyle]="showComments? {'display': 'block'} : {'display': 'none'}">
            <p class="subtitle fullwidth">Comments</p>
            <div *ngFor="let comment of data.permit.comments">
              <div class="row commentslist"
                *ngIf="(isClient && (comment?.createdby?.role != 8 && comment?.createdby?.role != 9 && comment?.createdby?.role != 10)) || (!isClient)">
                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(comment.message)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">{{comment.createdby.firstname}}
                  {{comment.createdby.lastname}}
                </p>
                <p class="pl-1 text-right" style="width: 25%;font-style:italic; color: #666666;
                              font-weight: 100;
                              font-weight: bold;">
                  {{ genericService.formatDateInDisplayFormatnew(comment.created_at) }}</p>
              </div>
            </div>
          </div>
          <!-- <div class="col-sm-6 col-12 mt-5"
                        *ngIf="!isClient && data.permit.reviewissues != '' && (data.permit.status == 'reviewfailed' || data.permit.status == 'reviewpassed'  || data.permit.status == 'delivered')">
                        <p class="subtitle fullwidth">Review comments</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="reviewissues" innerHTML="{{wrapURLs(data.permit.reviewissues)}}"></p>
                            </div>
                            <div class="col">
                                <p class="reviewissues float-right">{{data.permit?.reviewassignedto.firstname}}
                                    {{data.permit.reviewassignedto?.lastname || defaultvalue}}</p>
                            </div>
                        </div>
                    </div> -->
          <div class="col-sm-6 col-12 mt-5 align-items-center"
            *ngIf="data.permit.status == 'requestdeclined' || (data.permit.unhold && data.permit.requestdeclinereason)">
            <p class="subtitle fullwidth">On Hold Reason</p>
            <div class="subbody" *ngFor="let reason of data.permit.onholddesign">
              <!-- <div class="col" *ngIf="reason.status == 'onhold'">
                                <p class="contentvalue">{{reason.comment}}</p>
                            </div> -->

              <div class="row commentslist" *ngIf="reason.status == 'onhold'  && reason.comment !== null">

                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(reason.comment)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">
                  {{reason.createdby?.firstname}}{{reason.createdby?.lastname}}
                </p>
                <p class="pl-1 text-right"
                  style="width: 25%; font-style: italic; color: #666666; font-weight: 100;font-weight: bold;padding-right: 4px;">
                  {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.permit.status == 'requestdeclined' && data.permit.requestdeclineattachment?.length > 0 || (data.permit.unhold && data.permit.requestdeclineattachment.length > 0)">
            <p class="subtitle fullwidth">On Hold Attachments</p>
            <ng-container *ngFor="let reason of data.permit.onholddesign">
              <div *ngIf="reason.status == 'onhold' && reason.file.length" class="row subbody list-border commentslist">
                <ng-container *ngFor="let attachmentfile of reason.file; let i=index;">
                  <!-- <div class="col-2"> -->
                  <p class="contentheader" style="width: 8%">
                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                      src="{{attachmentfile.url}}">
                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                      src="./../assets/zip.svg">
                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                      src="./../assets/rtf.svg">
                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                      src="./../assets/txt.svg">
                    <img
                      *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                      class="material-icons file-icon" src="./../assets/file.svg">
                  </p>
                  <!-- </div> -->
                  <!-- <div class="col-10"> -->
                  <p style="width: 45%; word-wrap: break-word;display: flex">
                    <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                      attachmentfile.name |
                      uppercase }}</a>
                  </p>

                  <p class="pl-1" style="width:25%;justify-content: flex-end;text-align: -webkit-center;">
                    {{reason.createdby?.firstname}} {{reason.createdby?.lastname}}</p>
                  <p class="pl-1"
                    style="width:22%;justify-content: flex-end;font-style: italic; color: #666666; font-weight: 100;font-weight: bold;text-align: -webkit-center;">
                    {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
                  <!-- </div> -->
                </ng-container>
              </div>
            </ng-container>
          </div>

          <!-- un hold reason and attachment-->
          <div class="col-12  col-sm-6 mt-5 align-items-center"
            *ngIf="data.permit.unhold && data.permit.requestunholdreason">
            <p class="subtitle fullwidth">Un Hold Reason</p>
            <div class="subbody" *ngFor="let reason of data.permit.onholddesign">
              <!-- <div class="col" *ngIf="reason.status=='unhold'">
                             <p class="contentvalue">{{reason.comment}}</p>
                         </div> -->

              <div class="row commentslist" *ngIf="reason.status == 'unhold'  && reason.comment !== null">

                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(reason.comment)}}"></span>
                  <span>&#8221;</span>
                </p>

                <p class="pl-1 text-center" style="width: 25%;">
                  {{reason.createdby?.firstname}}{{reason.createdby?.lastname}}
                </p>
                <p class="pl-1 text-right"
                  style="width: 25%; font-style: italic; color: #666666; font-weight: 100;font-weight: bold;padding-right: 4px;">
                  {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="(this.data.permit.status == 'requestdeclined' && this.data.permit.requestunholdattachment?.length > 0) || (data.permit.unhold && data.permit.requestunholdattachment?.length > 0)">
            <p class="subtitle fullwidth">Un Hold Attachments</p>
            <ng-container *ngFor="let reason of data.permit.onholddesign">
              <div *ngIf="reason.status == 'unhold' && reason.file.length" class="row subbody list-border commentslist">
                <ng-container *ngFor="let attachmentfile of reason.file; let i=index;">
                  <!-- <div class="col-2"> -->
                  <p class="contentheader" style="width: 8%">
                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                      src="{{attachmentfile.url}}">
                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                      src="./../assets/zip.svg">
                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                      src="./../assets/rtf.svg">
                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                      src="./../assets/txt.svg">
                    <img
                      *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                      class="material-icons file-icon" src="./../assets/file.svg">
                  </p>
                  <!-- </div> -->
                  <!-- <div class="col-10"> -->
                  <p style="width: 45%; word-wrap: break-word;display: flex">
                    <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                      attachmentfile.name |
                      uppercase }}</a>
                  </p>

                  <p class="pl-1" style="width:25%;justify-content: flex-end;text-align: -webkit-center;">
                    {{reason.createdby?.firstname}} {{reason.createdby?.lastname}}</p>
                  <p class="pl-1"
                    style="width:22%;justify-content: flex-end;font-style: italic; color: #666666; font-weight: 100;font-weight: bold;text-align: -webkit-center;">
                    {{ genericService.formatDateInDisplayFormatnew(reason.created_at) }}</p>
                  <!-- </div> -->
                </ng-container>
              </div>
            </ng-container>
          </div>

          <div class="col-sm-6 col-12 mt-5 align-items-center" *ngIf="data.permit.isinrevisionstate">
            <p class="subtitle fullwidth">Revision Comments</p>
            <div class="row subbody" *ngFor="let revisiondesign of data.permit.revisiondesign">
              <div class="col d-flex justify-content-between">
                <p class="contentvalue" style="width: 50%;">{{revisiondesign.comment}}</p>
                <p class="contentvalue">{{revisiondesign.createdby != null?
                  revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                  revisiondesign.createdby.lastname: null}}</p>
                <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                  {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
              </div>
            </div>
          </div>

          <div class="col-12  col-sm-6 mt-5"
            *ngIf="data.permit.isinrevisionstate && data.permit.revisiondesign?.length > 0">
            <p class="subtitle fullwidth">Revision Design</p>
            <div class="row subbody" *ngFor="let revisiondesign of data.permit.revisiondesign ; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisiondesign.designfile.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Design file</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let designfile of revisiondesign.designfile">
                    <a href="{{designfile.url}}" target="_blank">{{
                      designfile.name |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisiondesign.createdby != null?
                    revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                    revisiondesign.createdby.lastname: null}}</p>
                </div>
                <div class="col-4">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
                </div>
              </div>
            </div>
            <div class="row subbody" *ngFor="let revisiondesign of data.permit.revisiondesign; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisiondesign.file.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Attachment</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let file of revisiondesign.file">
                    <a href="{{file.url}}" target="_blank">{{ file.name
                      |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisiondesign.createdby != null?
                    revisiondesign.createdby.firstname: "-"}} {{revisiondesign.createdby != null?
                    revisiondesign.createdby.lastname: null}}</p>
                </div>
                <div class="col-4">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisiondesign.created_at) }}</p>
                </div>
              </div>
            </div>
            <!--<div class="row subbody list-border" *ngFor="let revisiondesign of data.permit.revisiondesign">
                            <div class="col-12 d-flex">
                                <p class="col-6 contentheader" *ngIf="revisiondesign.designfile.length != 0">Design file</p>
                                <div class="col-6 pr-0">
                                    <p class="contentvalue text-right" *ngFor="let designfile of revisiondesign.designfile">
                                        <a href="{{designfile.url}}" target="_blank" class="contentvalue float-right pr-0">{{
                                            designfile.name | uppercase }}</a>
                                    </p>
                                </div>
                            </div>
                            <div class="col-12 d-flex">
                                <p class="col-6 contentheader" *ngIf="revisiondesign.file.length != 0">Attachment</p>
                                <div class="col-6 pr-0">
                                    <p class="contentvalue text-right" *ngFor="let file of revisiondesign.file">
                                        <a href="{{file.url}}" target="_blank" class="contentvalue float-right pr-0">{{ file.name
                                            |
                                            uppercase }}</a>
                                    </p>
                                </div>
                            </div>
                        </div>-->
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.permit.raiserequestreason != (null || '') && showRaiseRequestData">
            <p class="subtitle fullwidth">Raise Request Reason</p>
            <div class="row subbody">
              <div class="col d-flex justify-content-between">
                <p class="contentvalue" style="width: 50%;">{{data.permit.raiserequestreason}}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.permit?.raiserequestattachment?.length > 0 &&  showRaiseRequestData">
            <p class="subtitle fullwidth">Raise Request Attachment</p>
            <div class="row subbody list-border" *ngFor="let attachmentfile of data.permit.raiserequestattachment">
              <div class="col-2">
                <p class="contentheader">
                  <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                  <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon" src="./../assets/png.svg">
                  <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                  <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                  <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                  <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                  <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                  <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                  <img
                    *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                    class="material-icons file-icon" src="./../assets/file.svg">
                </p>
              </div>
              <div class="col-10">
                <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{ attachmentfile.name
                  | uppercase }}</a>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="(this.data.permit.status == 'designassigned' || this.data.permit.status == 'reviewfailed') && isUserDesigner">
          <div class="col-12 pb-5" *ngIf="designerCritera.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px">
              CheckList* <span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of designerCritera; let i = index">
                <div class="col-12">
                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback"
                        (change)="item.feedback == 'null'? item.feedback = true : item.feedback == true? item.feedback = false: item.feedback == false? item.feedback = true: null; onSaveCritetria(item,i)">
                      <img src="../../../assets/message.svg" width="23px" height="20px"
                        (click)="ShowCommentCriteria(item)"
                        *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)">
                    </div>

                  </div>

                  <ng-container *ngIf="!item.feedback">
                    <div class="row" *ngFor="let comment of item.comments; let j = index"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">
                        <div class="row" style="margin-left:0px">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                          <div class="col-4 d-flex justify-content-end"
                            *ngIf="loggedInUser.id==comment.createdby?.id && j==item.comments.length-1">
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/edit.svg"
                                (click)="editChecklistComment(comment,i,j,item)"></button>
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/delete.svg"
                                (click)="deleteChecklistComment(comment,i,j)"></button>
                          </div>
                        </div>
                        <mat-divider class="divider"></mat-divider>
                        <!-- <div class="row">
                                                <div class="col-12" ></div>
                                                </div>     -->

                        <!-- <hr /> -->
                      </div>
                    </div>
                  </ng-container>

                </div>


                <div class="col-12 pl-3 mt-2"
                  *ngIf="(isciteriacommentshow && selectedCriteria.id == item.id) || (isEditChecklist && selectedCriteria.id == item.id)">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="checklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button *ngIf="!isEditChecklist" (click)="onSaveCritetria(item,i)">Save</button>
                      <button mat-raised-button *ngIf="isEditChecklist" (click)="onEditComments()">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
          <div class="col-6 align-items-center">
            <p class="subtitle fullwidth" *ngIf="!this.genericService.specificclient">Upload Permit Design*
              <span style="color: red; " *ngIf="displayerror">Required</span>
            </p>
            <p class="subtitle fullwidth" *ngIf="this.genericService.specificclient">Upload Design*
              <span style="color: red; " *ngIf="displayerror">Required</span>
            </p>
            <div class="custom-dropzone" ngx-dropzone [multiple]="false" [accept]="' .pdf,.zip'"
              (change)="onSelect($event)" *ngIf="!isPermitDesignSelected">
              <ngx-dropzone-label>
                <div>
                  <img class="addimage" src="../../../../../assets/add.svg">
                  <h5 *ngIf="!this.genericService.specificclient">Drag and drop your permit design
                    here or click to browse.</h5>
                  <h5 *ngIf="this.genericService.specificclient">Drag and drop your design here or
                    click to browse.</h5>
                </div>
              </ngx-dropzone-label>
            </div>
            <div class="row pdfselectionpreview align-items-center" *ngIf="isPermitDesignSelected">
              <div class="col-2">

                <img *ngIf="extension == 'pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'png'" class="material-icons file-icon" src="./../assets/png.svg">
                <img *ngIf="extension == 'zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                <img *ngIf="extension == 'doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                <img *ngIf="extension == 'txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                <img
                  *ngIf="extension !== 'png' && extension !== 'pdf' && extension !== 'zip' && extension !== 'doc' && extension !== 'docx' && extension !== 'odt' && extension !== 'rtf' && extension !== 'txt'"
                  class="material-icons file-icon" src="./../assets/file.svg">

              </div>
              <div class="col-7">
                <p>{{permitfiles[0].name}}</p>
              </div>
              <div class="col-3">
                <button class="float-right bluebutton" mat-raised-button (click)="onRemove()">Remove</button>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12">
            <p class="subtitle fullwidth">Comments</p>
            <mat-form-field appearance="fill" class="fullwidth">
              <mat-label>comments</mat-label>
              <textarea style="height: 132px;" matInput placeholder="Ex. Start typing here..."
                [formControl]="designcomments"></textarea>
            </mat-form-field>
          </div>
          <div class="col">
            <button class="float-right ml-1" mat-raised-button (click)="uploadPermitDesign()">Submit</button>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="(isUserAnalyst && this.data.permit.status == 'reviewassigned') || (data.permit.status == 'reviewassigned' && data.permit.reviewassignedto.id == this.loggedInUser.id)">
          <div class="col-12 pb-5" *ngIf="designerCritera.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px">
              CheckList*<span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of designerCritera; let i = index">

                <div class="col-12">

                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback"
                        (change)="item.feedback == false ? item.feedback = true : item.feedback == true? item.feedback = false: null; onSaveCritetria(item,i)">
                      <img src="../../../assets/message.svg" width="23px" height="20px"
                        (click)="ShowCommentCriteria(item)"
                        *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)">
                    </div>

                  </div>


                  <ng-container *ngIf="!item.feedback">
                    <div *ngFor="let comment of item.comments; let j = index;"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">

                        <div class="row">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                          <div class="col-4 d-flex justify-content-end"
                            *ngIf="loggedInUser.id==comment.createdby?.id && j==item.comments.length-1">
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/edit.svg"
                                (click)="editChecklistCommentForAnalyst(comment,i,j,item)"></button>
                            <button mat-icon-button><img class="content-icon" src="../../../../../assets/delete.svg"
                                (click)="deleteChecklistComment(comment,i,j)"></button>
                          </div>

                          <!-- <hr /> -->
                        </div>
                        <mat-divider class="divider"></mat-divider>
                      </div>
                    </div>
                  </ng-container>


                </div>



                <div class="col-12 pl-3 mt-2"
                  *ngIf="(isciteriacommentshow && selectedCriteria.id == item.id) || (isEditChecklist && selectedCriteria.id == item.id)">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="anyalistchecklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button *ngIf="!isEditChecklist" (click)="onSaveCritetria(item,i)">Save</button>
                      <button mat-raised-button *ngIf="isEditChecklist" (click)="onEditComments()">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="((data.permit.status == 'designcompleted' || data.permit.status == 'reviewpassed' || data.permit.status == 'delivered' || (data.permit.status=='designassigned' && !isUserDesigner) || (data.permit.status=='reviewfailed' && !isUserDesigner) || (data.permit.status == 'reviewassigned' && !isUserAnalyst  && data.permit.reviewassignedto.id != this.loggedInUser.id)) && !isClient)">

          <div class="col-12 pb-5" *ngIf="designerCritera.length != 0">
            <p class="subtitle fullwidth"><img src="../../../assets/checklist.svg" width="15px" height="12px"> CheckList
              *<span style="color: red;" *ngIf="displayerror">Required</span>
            </p>
            <div class="" style="height: 255px; overflow-y: auto; overflow-x: hidden;">
              <div class="row pr-2" *ngFor="let item of designerCritera; let i = index">


                <div class="col-12">

                  <div class="row">
                    <div class="col-9">
                      <div class="d-flex">
                        <img src="../../../assets/double-tick.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="item.feedback">
                        <img src="../../../assets/close.svg" width="13px" height="20px" class="mr-2"
                          *ngIf="!item.feedback">
                        <p class="mb-1">{{item.criteriatitle}}</p>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end checkbox">
                      <input type="checkbox" class="mt-1 mr-2" [checked]="item.feedback" disabled='true'>
                      <!-- <img src="../../../assets/message.svg" width="23px" height="20px"
                                                (click)="ShowCommentCriteria(item)" *ngIf="!item.feedback && (item.comments[item.comments.length-1]?.createdby.id != loggedInUser.id || item.comments.length == 0)"> -->
                    </div>

                  </div>


                  <ng-container *ngIf="!item.feedback">
                    <div *ngFor="let comment of item.comments; let j = index;"
                      style="color: #666666; padding-left: 21px; margin-bottom: 0px;">
                      <div class="col-12">
                        <div class="row">
                          <div class="col-8">
                            <p style="font-weight: 500;margin:0px;color: #666666;">
                              {{comment.createdby?.firstname | titlecase}}
                              {{comment.createdby?.lastname | titlecase}}</p>
                            <small style="font-style: italic;font-weight: bold;color: #6666;">{{comment.updated_at
                              | date:'dd MMM yy- HH:mm'}}</small><br />
                            <p>
                              {{comment.message}}</p>
                          </div>
                        </div>
                        <mat-divider class="divider"></mat-divider>
                        <!-- <div class="row">
                                                    <div class="col-12" ></div>
                                                    </div>   -->
                      </div>
                    </div>
                  </ng-container>


                </div>

                <div class="col-12 pl-3 mt-2" *ngIf="isciteriacommentshow && selectedCriteria.id == item.id">
                  <!-- <p class="col-11">{{item.checklistcriteriaid.criteria}}</p> -->
                  <div class="row mx-0">
                    <div class="col-10">
                      <mat-form-field appearance="fill" class="fullwidth">
                        <textarea style="height: 22px;" matInput placeholder="Add your comments here..."
                          [formControl]="anyalistchecklistcomments"></textarea>
                      </mat-form-field>
                    </div>
                    <div class="col-2 d-flex align-items-end justify-content-end pl-0 pb-4">
                      <button class="mr-2" mat-raised-button (click)="onCancelCriteria()">Cancel</button>
                      <button mat-raised-button (click)="onSaveCritetria(item,i)">Save</button>
                    </div>
                  </div>
                </div>
                <hr class="w-100 mr-2">
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-5"
          *ngIf="(isUserAnalyst && this.data.permit.status == 'reviewassigned') || (this.data.permit.status == 'reviewassigned' && this.data.permit.reviewassignedto.id == this.loggedInUser.id)">
          <div *ngIf="isselfupdatepermit" class="col align-items-center">
            <p class="subtitle fullwidth" *ngIf="!this.genericService.specificclient">Upload Permit Design*
              <span style="color: red; " *ngIf="displayerror">Required</span>
            </p>
            <p class="subtitle fullwidth" *ngIf="this.genericService.specificclient">Upload Design*s
              <span style="color: red; " *ngIf="displayerror">Required</span>
            </p>
            <div class="custom-dropzone" ngx-dropzone [multiple]="false" (change)="onSelect($event)"
              [accept]="' .pdf,.zip'" *ngIf="!isPermitDesignSelected ;
">
              <ngx-dropzone-label>
                <div>
                  <img class="addimage" src="../../../../../assets/add.svg">
                  <h5>Drag and drop your sales proposal here or click to browse</h5>
                </div>
              </ngx-dropzone-label>
            </div>
            <div class="row pdfselectionpreview align-items-center" *ngIf="  isPermitDesignSelected
">
              <div class="col-2">
                <img *ngIf="extension == 'pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'png'" class="material-icons file-icon" src="./../assets/png.svg">
                <img *ngIf="extension == 'zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                <img *ngIf="extension == 'doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                <img *ngIf="extension == 'odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                <img *ngIf="extension == 'rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                <img *ngIf="extension == 'txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                <img
                  *ngIf="extension!== 'png' && extension !== 'pdf' && extension !== 'zip' && extension !== 'doc' && extension !== 'docx' && extension !== 'odt' && extension !== 'rtf' && extension !== 'txt'"
                  class="material-icons file-icon" src="./../assets/file.svg">

              </div>
              <div class="col-7">
                <p>{{permitfiles[0].name}}</p>
              </div>
              <div class="col-3">
                <button class="float-right bluebutton" mat-raised-button (click)="onRemove()">Remove</button>
              </div>
            </div>
            <button class="float-right ml-1" mat-button (click)="selfUpdateCancelClick()">Cancel</button>
          </div>
          <div class="col">
            <p class="subtitle fullwidth">Issues</p>
            <div class="row subbody">
              <div class="col">
                <mat-form-field appearance="fill" class="fullwidth">
                  <mat-label>comments</mat-label>
                  <textarea class="largetextarea" matInput placeholder="Enter your issues here..."
                    [formControl]="reviewissues"></textarea>
                  <mat-error *ngIf="reviewissues.invalid">{{getErrorMessage(reviewissues)}}
                  </mat-error>
                </mat-form-field>
                <p style="color: red;font-size: smaller;" *ngIf="reviewissuesinvalid==true">Please Enter
                  issue</p>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <button class="float-right ml-1" *ngIf="!isselfupdatepermit" mat-raised-button
                  (click)="reportDesignReviewFailure()">Failed</button>
                <button class="float-right" mat-raised-button (click)="updateDesignReviewSuccess()">Passed</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
    <mat-tab *ngIf="data.pestamp!=null || data.pestamp!=undefined">
      <ng-template matTabLabel *ngIf="isClient">
        {{userSettings?.namepestamp}}
      </ng-template>
      <ng-template matTabLabel *ngIf="!isClient">
        Pestamp
      </ng-template>
      <div class="detailsdialog">
        <div class="row mt-3">
          <div class="col-12 col-sm-6">
            <p class="subtitle fullwidth">Customer Details</p>
            <div class="row subbody">
              <div class="col-6">
                <p class="contentheader">Name</p>
                <p class="contentheader">Phone Number</p>
                <p class="contentheader">Email</p>
                <p class="contentheader">Created By</p>
              </div>
              <div class="col-6">
                <p class="contentvalue text-right">{{ (data.pestamp?.personname | titlecase) ||
                  defaultvalue}}</p>
                <p class="contentvalue text-right">{{ data.pestamp?.contactnumber || defaultvalue}}</p>
                <p class="contentvalue text-right">{{ data.pestamp?.email || defaultvalue}}</p>
                <p class="contentvalue text-right">{{ data.pestamp.createdby.firstname }} {{
                  data.pestamp.createdby.lastname }}</p>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6">
            <p class="subtitle fullwidth">Job Details</p>
            <div class="row subbody">
              <div class="col-6">
                <p class="contentheader">Request Type</p>
                <p class="contentheader">Mode of Stamping</p>
                <p class="contentheader" *ngIf="data.pestamp.hardcopies != null">Hard copies</p>
                <p class="contentheader" *ngIf="data.pestamp.type=='electrical' ||data.pestamp.type=='both'">Job Type
                </p>
                <p class="contentheader" class="contentheader" *ngIf="data.pestamp.deliveryaddress != null">Shipping
                  Address
                </p>
                <p class="contentheader"
                  *ngIf="data.pestamp.status=='delivered' && (data.pestamp.modeofstamping == 'hardcopy' || data.pestamp.modeofstamping == 'both')">
                  Shipping Charges</p>
              </div>
              <div class="col-6">
                <p class="contentvalue text-right">{{ (data.pestamp?.type | titlecase) || defaultvalue
                  }}</p>
                <p class="contentvalue text-right">{{ (data.pestamp?.modeofstamping | titlecase) ||
                  defaultvalue }}</p>
                <p class="contentvalue text-right">{{ data.pestamp.hardcopies }}</p>
                <p class="contentvalue text-right" *ngIf="data.pestamp.jobtype!='pvbattery'">{{
                  data.pestamp.jobtype |
                  titlecase }}</p>
                <p class="contentvalue text-right" *ngIf="data.pestamp.jobtype=='pvbattery'">PV+Battery
                </p>
                <p class="contentvalue text-right" *ngIf="data.pestamp.deliveryaddress != null">{{
                  data.pestamp.deliveryaddress }}</p>
                <p class="contentvalue text-right"
                  *ngIf="data.pestamp.status=='delivered' && (data.pestamp.modeofstamping == 'hardcopy' || data.pestamp.modeofstamping == 'both')">
                  {{data.pestamp.deliverycharges}}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6 mt-3">
            <p class="subtitle fullwidth">Mounting Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Mounting type</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ (data.pestamp?.mountingtype | titlecase) ||
                  defaultvalue}}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 mt-3">
            <p class="subtitle fullwidth">Property Details</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">Property type</p>
              </div>
              <div class="col">
                <p class="contentvalue text-right">{{ (data.pestamp?.propertytype | titlecase)||
                  defaultvalue }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-sm-6 mt-5" *ngIf="this.data.pestamp.thirdpartystamping != null">
            <mat-checkbox [checked]="this.data.pestamp.thirdpartystamping" disabled>3rd party stamping required
            </mat-checkbox>
          </div>
          <div class="col-12 col-sm-6 mt-5"
            *ngIf="(this.data.pestamp.type=='structural' ||this.data.pestamp.type=='both')&& data.pestamp.atticphotos.length > 0">
            <p class="subtitle fullwidth">Attic Photos</p>
            <p class="containers">
              <ng-container *ngFor="let item of atticphotos; index as i">
                <a style="position: relative;" (mouseenter)="attichoverIdx = i" (mouseleave)="attichoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide':attichoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 20px;width: 20px;"
                      (click)="downloadSingleFile(item)" />
                  </span>
                  <img class="material-icons attachment-img" [lightbox]="i" [src]="item.data.thumb"
                    [gallery]="'atticphotos'" width="95%" height="95%" />
                </a>
              </ng-container>
            </p>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="(this.data.pestamp.type=='structural' ||this.data.pestamp.type=='both') && data.pestamp.roofphotos.length > 0">
            <p class="subtitle fullwidth">Roof Photos</p>
            <p class="containers">
              <ng-container *ngFor="let item of roofphotos; index as i">
                <a style="position: relative;" (mouseenter)="roofhoverIdx = i" (mouseleave)="roofhoverIdx = -1">
                  <span [ngClass]="{ 'overlay-icon': true, 'hide': roofhoverIdx != i }">
                    <img src="../../../assets/downloadicon.svg" style="height: 20px;width: 20px;"
                      (click)="downloadSingleFile(item)" />
                  </span>
                  <img [lightbox]="i" [src]="item.data.thumb" [gallery]="'roofphotos'" />
                </a>
              </ng-container>
            </p>
          </div>
          <div class="col-12  col-sm-6 mt-5" *ngIf="data.pestamp.permitplan?.length > 0">
            <p class="subtitle fullwidth">Permit plan</p>
            <div class="row subbody " *ngFor="let file of data.pestamp.permitplan">
              <div class="col-2">
                <p class="contentheader">
                  <img *ngIf="file.ext == '.pdf'" class="material-icons" src="./../assets/pdf.svg" width="60px"
                    height="60px">
                  <img *ngIf="file.ext == '.png'" class="material-icons file-icon" src="./../assets/png.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.zip'" class="material-icons file-icon" src="./../assets/zip.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.doc'" class="material-icons file-icon" src="./../assets/doc.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.docx'" class="material-icons file-icon" src="./../assets/doc.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.odt'" class="material-icons file-icon" src="./../assets/pdf.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.rtf'" class="material-icons file-icon" src="./../assets/rtf.svg"
                    width="60px" height="60px">
                  <img *ngIf="file.ext == '.txt'" class="material-icons file-icon" src="./../assets/txt.svg"
                    width="60px" height="60px">
                  <img
                    *ngIf="file.ext !== '.png' && file.ext !== '.pdf' && file.ext !== '.zip' && file.ext !== '.doc' && file.ext !== '.docx' && file.ext !== '.odt' && file.ext !== '.rtf' && file.ext !== '.txt'"
                    class="material-icons file-icon" src="./../assets/file.svg" width="60px" height="60px">
                </p>
              </div>
              <div class="col-10 d-flex justify-content-end">
                <a href="{{file.url}}" target="_blank" class="contentvalue float-right" style="margin: auto 0px;">{{
                  file.name |
                  uppercase }}</a>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5" *ngIf="data.pestamp.comments.length > 0"
            [ngStyle]="showComments? {'display': 'block'} : {'display': 'none'}">
            <p class="subtitle fullwidth">Comments</p>
            <div *ngFor="let comment of data.pestamp.comments">
              <div class="row commentslist"
                *ngIf="(isClient && (comment.createdby?.role != 8 && comment?.createdby?.role != 9 && comment?.createdby?.role != 10)) || (!isClient)">
                <p style="width: 50%; word-wrap: break-word;">
                  <span>&#8220;</span>
                  <span innerHTML="{{wrapURLs(comment.message)}}"></span>
                  <span>&#8221;</span>
                </p>
                <p class="pl-1 text-center" style="width: 25%;">{{comment.createdby?.firstname}}
                  {{comment.createdby?.lastname}}
                </p>
                <p class="pl-1 text-right" style="width: 25%; font-style: italic; color: #666666; font-weight: 80%;">
                  {{ genericService.formatDateInDisplayFormatnew(comment.created_at) }}</p>
              </div>
            </div>
          </div>
          <!--   <div class="col-12  col-sm-6 mt-5"
                        *ngIf="(((this.data.pestamp.status == 'completed'   || this.data.pestamp.status == 'delivered') && !isClient && this.data.pestamp.iselectricalstampeduploaded) || ((this.data.pestamp.status == 'delivered') && isClient && this.data.pestamp.iselectricalstampeduploaded)) || (this.data.pestamp.type =='both' && this.loggedInUser.peengineertype=='electrical' && this.data.pestamp.iselectricalstampeduploaded)"
                        [hidden]="this.loggedInUser.peengineertype=='structural'">
                        <p class="subtitle fullwidth"> Electrical Stamped File</p>
                        <div class="row subbody" *ngFor="let file of data.pestamp.electricalstampedfiles">
                            <div class="col">
                                <p class="contentheader">View File</p>
                            </div>
                            <div class="col">
                                <a href="{{file.url}}" target="_blank" class="contentvalue float-right">{{
                                    file.name | titlecase }}</a>
                            </div>
                        </div>
                    </div> -->
          <!-- <div class="col-12  col-sm-6 mt-5"
                        *ngIf="(((this.data.pestamp.status == 'completed'   || this.data.pestamp.status == 'delivered') && !isClient && this.data.pestamp.isstructuralstampeduploaded) || ((this.data.pestamp.status == 'delivered') && isClient && this.data.pestamp.isstructuralstampeduploaded)) || (this.data.pestamp.type =='both' && this.loggedInUser.peengineertype=='structural' && this.data.pestamp.isstructuralstampeduploaded)"
                        [hidden]="this.loggedInUser.peengineertype=='electrical'">
                        <p class="subtitle fullwidth">Structural Stamped File</p>
                        <div class="row subbody" *ngFor="let file of data.pestamp.structuralstampedfiles">
                            <div class="col">
                                <p class="contentheader">View File</p>
                            </div>
                            <div class="col">
                                <a href="{{file.url}}" target="_blank" class="contentvalue float-right">{{
                                    file.name | titlecase }}</a>
                            </div>
                        </div>
                    </div> -->
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="(((this.data.pestamp.status == 'completed'   || this.data.pestamp.status == 'delivered') && !isClient ) || ((this.data.pestamp.status == 'delivered') && isClient)) ">
            <p class="subtitle fullwidth">Stamped File</p>
            <div class="row subbody" *ngFor="let files of data.pestamp.stampedfiles">
              <div class="col">
                <!-- <p class="contentheader">View File</p> -->
                <img class="material-icons " src="./../assets/pdf.svg" width="60px" height="60px">
              </div>
              <div class="col d-flex justify-content-end">
                <a href="{{files.url}}" target="_blank" class="contentvalue float-right" style="margin: auto 0px;">{{
                  files.name | titlecase }}</a>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="((this.data.pestamp.status == 'completed'|| this.data.pestamp.status == 'delivered')&& this.data.pestamp.propertytype=='commercial') ">
            <p class="subtitle fullwidth">Working Hours</p>
            <div class="row subbody">
              <div class="col">
                <p class="contentheader">PE engineer working hours</p>
              </div>
              <div class="col">
                <p class="contentvalue float-right">{{this.data.pestamp.workinghours}}</p>
              </div>
            </div>
          </div>

          <!-- <div class="col-12  col-sm-6 mt-5"
                        *ngIf="((this.data.pestamp.modeofstamping == 'hardcopy' || this.data.pestamp.modeofstamping == 'both' || this.data.pestamp.status == 'delivered')&& this.data.pestamp.propertytype=='commercial') ">
                        <p class="subtitle fullwidth">Working Hours 11</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="contentheader">PE engineer working hours</p>
                            </div>
                            <div class="col">
                                <p class="contentvalue float-right">{{this.data.pestamp.deliverycharges}}</p>
                            </div>
                        </div>
                    </div> -->
          <!-- <div class="col-12  col-sm-6 mt-5"
                        *ngIf="((this.data.pestamp.status == 'completed'|| this.data.pestamp.status == 'delivered')&& this.data.pestamp.propertytype=='commercial')  && this.data.pestamp.type=='both' && loggedInUser.peengineertype !='structural'">
                        <p class="subtitle fullwidth">Electrical Stamp Working Hours</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="contentheader">PE engineer working hours</p>
                            </div>
                            <div class="col">
                                <p class="contentvalue float-right">{{this.data.pestamp.electricalworkinghours}}</p>
                            </div>
                        </div>
                    </div> -->
          <!--  <div class="col-12  col-sm-6 mt-5"
                        *ngIf="((this.data.pestamp.status == 'completed'|| this.data.pestamp.status == 'delivered')&& this.data.pestamp.propertytype=='commercial')  && this.data.pestamp.type=='both' && loggedInUser.peengineertype !='electrical'">
                        <p class="subtitle fullwidth">Structural Stamp Working Hours</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="contentheader">PE engineer working hours</p>
                            </div>
                            <div class="col">
                                <p class="contentvalue float-right">{{this.data.pestamp.structuralworkinghours}}</p>
                            </div>
                        </div>
                    </div> -->
          <div class="col-12 col-sm-6 mt-5 "
            *ngIf="this.data.pestamp.status == 'declined' || data.pestamp.onholdpestamp?.length || data.pestamp.requestdeclinereason != null">
            <p class="subtitle fullwidth">Reason</p>
            <ng-container *ngIf="data.pestamp.requestdeclinereason && data.pestamp.onholdpestamp?.length == 0">
              <div class="row subbody">
                <div class="col">
                  <p class="contentvalue">{{this.data.pestamp.requestdeclinereason}}</p>
                </div>
              </div>
            </ng-container>
            <ng-container
              *ngIf="(data.pestamp.requestdeclinereason == null && data.pestamp.onholdpestamp?.length) || (data.pestamp.requestdeclinereason && data.pestamp.onholdpestamp?.length)">
              <div class="col-12 subbody px-0" *ngFor="let item of data.pestamp.onholdpestamp">
                <div class="d-flex mb-2 commentslist">
                  <div class="col-5 pl-0">
                    <p>{{item.comment}}</p>
                  </div>
                  <div class="col-4">
                    <p>{{item.createdby.firstname}} {{item.createdby.lastname}}</p>
                  </div>
                  <div class="col-3">
                    <p class="pl-1 text-right" style="font-style: italic; color: #666666; font-weight: 80%;">
                      {{ genericService.formatDateInDisplayFormatnew(item.created_at) }}</p>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="col-sm-6 col-12 mt-5 "
            *ngIf="(this.data.pestamp.status == 'declined' && data.pestamp.requestdeclineattachment.length) || data.pestamp.requestdeclineattachment.length || (data.pestamp.onholdpestamp && isOnholdAttachments)">
            <p class="subtitle fullwidth">Request Decline Attachments</p>
            <ng-container
              *ngIf="(data.pestamp.requestdeclineattachment?.length && !data.pestamp.onholdpestamp?.length) || (data.pestamp.requestdeclineattachment?.length && (data.pestamp.onholdpestamp?.length && !isOnholdAttachments))">
              <div class="row subbody list-border" *ngFor="let attachmentfile of data.pestamp.requestdeclineattachment">
                <div class="col-2">
                  <p class="contentheader">
                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                      src="./../assets/png.svg">
                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                      src="./../assets/zip.svg">
                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                      src="./../assets/doc.svg">
                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                      src="./../assets/pdf.svg">
                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                      src="./../assets/rtf.svg">
                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                      src="./../assets/txt.svg">
                    <img
                      *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                      class="material-icons file-icon" src="./../assets/file.svg">
                  </p>
                </div>
                <div class="col-10">
                  <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                    attachmentfile.name |
                    uppercase }}</a>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="data.pestamp.onholdpestamp?.length && isOnholdAttachments">
              <div class="col-12 subbody px-0" *ngFor="let item of data.pestamp.onholdpestamp">
                <div class="d-flex mb-2 commentslist" *ngFor="let file of item.file">
                  <div class="col-5 pl-0 d-flex">
                    <p class="contentheader">
                      <img *ngIf="file.ext == '.pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                      <img *ngIf="file.ext == '.png'" class="material-icons file-icon" src="./../assets/png.svg">
                      <img *ngIf="file.ext == '.zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                      <img *ngIf="file.ext == '.doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                      <img *ngIf="file.ext == '.docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                      <img *ngIf="file.ext == '.odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                      <img *ngIf="file.ext == '.rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                      <img *ngIf="file.ext == '.txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                      <img
                        *ngIf="file.ext !== '.png' && file.ext !== '.pdf' && file.ext !== '.zip' && file.ext !== '.doc' && file.ext !== '.docx' && file.ext !== '.odt' && file.ext !== '.rtf' && file.ext !== '.txt'"
                        class="material-icons file-icon" src="./../assets/file.svg">
                    </p>
                    <a href="{{file.url}}" target="_blank" class="contentvalue float-right">{{ file.name}}</a>
                  </div>
                  <div class="col-4">
                    <p>{{item.createdby.firstname}} {{item.createdby.lastname}}</p>
                  </div>
                  <div class="col-3">
                    <p class="pl-1 text-right" style="font-style: italic; color: #666666; font-weight: 80%;">
                      {{ genericService.formatDateInDisplayFormatnew(item.created_at) }}</p>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
          <!-- <div class="col-sm-6 col-12 mt-5 align-items-center" *ngIf="this.data.pestamp.isinrevisionstate">
                        <p class="subtitle fullwidth">Revision Comments</p>
                        <div class="row subbody">
                            <div class="col">
                                <p class="contentvalue">{{this.data.pestamp.revisioncomments}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-12 mt-5"
                        *ngIf="this.data.pestamp.isinrevisionstate && this.data.pestamp.revisionattachments.length > 0">
                        <p class="subtitle fullwidth">Revision Attachments</p>
                        <div class="row subbody list-border"
                            *ngFor="let attachmentfile of data.pestamp.revisionattachments">
                            <div class="col-2">
                                <p class="contentheader">
                                    <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon"
                                        src="./../assets/png.svg">
                                    <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon"
                                        src="./../assets/zip.svg">
                                    <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon"
                                        src="./../assets/doc.svg">
                                    <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon"
                                        src="./../assets/pdf.svg">
                                    <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon"
                                        src="./../assets/rtf.svg">
                                    <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon"
                                        src="./../assets/txt.svg">
                                    <img *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                                        class="material-icons file-icon" src="./../assets/file.svg">
                                </p>
                            </div>
                            <div class="col-10">
                                <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{
                                    attachmentfile.name |
                                    uppercase }}</a>
                            </div>
                        </div>
                    </div> -->
          <div class="col-sm-6 col-12 mt-5 align-items-center"
            *ngIf="data.pestamp?.isinrevisionstate && this.data.pestamp.revisionpestamp?.length > 0">
            <p class="subtitle fullwidth">Revision Comments</p>
            <div class="row subbody" *ngFor="let revisiondesign of data.pestamp?.revisionpestamp">
              <div class="col d-flex justify-content-between">
                <p class="contentvalue" style="width: 50%;">{{revisiondesign?.comment}}</p>
                <p class="contentvalue">{{revisiondesign?.createdby != null?
                  revisiondesign.createdby?.firstname: "-"}} {{revisiondesign?.createdby != null?
                  revisiondesign.createdby?.lastname: null}}</p>
                <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                  {{ genericService.formatDateInDisplayFormatnew(revisiondesign?.created_at) }}</p>
              </div>
            </div>
          </div>
          <div class="col-12  col-sm-6 mt-5"
            *ngIf="this.data.pestamp.isinrevisionstate && this.data.pestamp.revisionpestamp?.length > 0">
            <p class="subtitle fullwidth">Revision Pestamp</p>
            <div class="row subbody" *ngFor="let revisionpestamp of data.pestamp?.revisionpestamp ; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisionpestamp.pestampfile?.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Stamped file</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let pestampfile of revisionpestamp?.pestampfile">
                    <a href="{{pestampfile.url}}" target="_blank">{{
                      pestampfile.name |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisionpestamp.createdby != null?
                    revisionpestamp.createdby.firstname: "-"}} {{revisionpestamp.createdby != null?
                    revisionpestamp.createdby.lastname: null}}</p>
                </div>
                <div class="col-4" style="padding-left: 0px;">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisionpestamp.created_at) }}</p>
                </div>
              </div>
            </div>
            <div class="row subbody" *ngFor="let revisionpestamp of data.pestamp?.revisionpestamp; let index = index">
              <div style="margin-right: 10rem !important;" class="pl-1 col d-flex justify-content-between"
                *ngIf="revisionpestamp.file.length != 0">
                <div class="col-3">
                  <p class="contentheader" [ngStyle]="index == 0? {'visibility': 'visible'} : {'visibility': 'hidden'}">
                    Attachment</p>
                </div>
                <div class="col-7">
                  <p class="contentvalue" *ngFor="let file of revisionpestamp?.file">
                    <a href="{{file.url}}" target="_blank">{{ file.name
                      |
                      uppercase }}</a>
                  </p>
                </div>
                <div class="col-4">
                  <p class="contentvalue">{{revisionpestamp.createdby != null?
                    revisionpestamp.createdby.firstname: "-"}} {{revisionpestamp.createdby != null?
                    revisionpestamp.createdby.lastname: null}}</p>
                </div>
                <div class="col-4">
                  <p class="contentvalue" style="font-style:italic; color: #666666;
                                font-weight: bold;">
                    {{ genericService.formatDateInDisplayFormatnew(revisionpestamp.created_at) }}</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.pestamp.raiserequestreason != (null || '') && showRaiseRequestData">
            <p class="subtitle fullwidth">Raise Request Reason</p>
            <div class="row subbody">
              <div class="col d-flex justify-content-between">
                <p class="contentvalue" style="width: 50%;">{{data.pestamp.raiserequestreason}}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-12 mt-5"
            *ngIf="data.pestamp?.raiserequestattachment.length > 0 &&  showRaiseRequestData">
            <p class="subtitle fullwidth">Raise Request Attachment</p>
            <div class="row subbody list-border" *ngFor="let attachmentfile of data.pestamp.raiserequestattachment">
              <div class="col-2">
                <p class="contentheader">
                  <img *ngIf="attachmentfile.ext == '.pdf'" class="material-icons file-icon" src="./../assets/pdf.svg">
                  <img *ngIf="attachmentfile.ext == '.png'" class="material-icons file-icon" src="./../assets/png.svg">
                  <img *ngIf="attachmentfile.ext == '.zip'" class="material-icons file-icon" src="./../assets/zip.svg">
                  <img *ngIf="attachmentfile.ext == '.doc'" class="material-icons file-icon" src="./../assets/doc.svg">
                  <img *ngIf="attachmentfile.ext == '.docx'" class="material-icons file-icon" src="./../assets/doc.svg">
                  <img *ngIf="attachmentfile.ext == '.odt'" class="material-icons file-icon" src="./../assets/pdf.svg">
                  <img *ngIf="attachmentfile.ext == '.rtf'" class="material-icons file-icon" src="./../assets/rtf.svg">
                  <img *ngIf="attachmentfile.ext == '.txt'" class="material-icons file-icon" src="./../assets/txt.svg">
                  <img
                    *ngIf="attachmentfile.ext !== '.png' && attachmentfile.ext !== '.pdf' && attachmentfile.ext !== '.zip' && attachmentfile.ext !== '.doc' && attachmentfile.ext !== '.docx' && attachmentfile.ext !== '.odt' && attachmentfile.ext !== '.rtf' && attachmentfile.ext !== '.txt'"
                    class="material-icons file-icon" src="./../assets/file.svg">
                </p>
              </div>
              <div class="col-10">
                <a href="{{attachmentfile.url}}" target="_blank" class="contentvalue float-right">{{ attachmentfile.name
                  | uppercase }}</a>
              </div>
            </div>
          </div>
        </div>
        <ng-container
          *ngIf="(( this.data.pestamp.acceptedbypeengineer==true && isUserPeEngineer) || (data.pestamp.acceptedbypesuperadmin && isPesuperadmin)) && data.pestamp.assignedto?.id == loggedInUser.id && data.pestamp.status == 'assigned'">
          <div class="row mt-5">
            <div class="col-12 col-sm-6 align-items-center">
              <p class="subtitle fullwidth">Upload Stamped File*
                <span style="color: red; " *ngIf="displayerror">Required</span>
              </p>
              <div class="custom-dropzone" ngx-dropzone [multiple]="true"
                [accept]="'image/*, audio/*, .pdf,.zip,.doc,.odt,.txt, .docx ,rar'" (change)="onSelectPestamp($event)"
                *ngIf="!isPestampSelcted">
                <ngx-dropzone-label>
                  <div>
                    <img class="addimage" src="../../../../../assets/add.svg">
                    <h5>Drag and drop your stamped file here or click to browse</h5>
                  </div>
                </ngx-dropzone-label>
              </div>
              <div class="row pdfselectionpreview align-items-center" *ngIf="isPestampSelcted">
                <div class="col-12" *ngFor="let files of pestampfiles , let i = index">
                  <div class="row">
                    <div class="col-2">
                      <!--  <img *ngIf="files.name.substring(files.name.lastIndexOf('.')) == 'pdf'" class="material-icons file-icon"
                                    src="./../assets/pdf.svg">
                                <img *ngIf="files.name.substring(element.name.lastIndexOf('.')) == 'png'" class="material-icons file-icon"
                                    src="./../assets/png.svg">
                                <img *ngIf="files.name.substring(element.name.lastIndexOf('.')) == 'zip'" class="material-icons file-icon"
                                    src="./../assets/zip.svg">
                                <img *ngIf="files.name.substring(element.name.lastIndexOf('.'))== 'doc'" class="material-icons file-icon"
                                    src="./../assets/doc.svg">
                                <img *ngIf="files.type == 'docx'" class="material-icons file-icon"
                                    src="./../assets/doc.svg">
                                <img *ngIf="files.type == 'odt'" class="material-icons file-icon"
                                    src="./../assets/pdf.svg">
                                <img *ngIf="files.type == 'rtf'" class="material-icons file-icon"
                                    src="./../assets/rtf.svg">
                                <img *ngIf="files.type == 'txt'" class="material-icons file-icon"
                                    src="./../assets/txt.svg"> -->
                      <img class="material-icons file-icon" src="./../assets/file.svg">

                    </div>
                    <div class="col-7">
                      <p>{{files.name}}</p>
                    </div>
                    <div class="col-3">
                      <button class="float-right bluebutton" mat-raised-button
                        (click)="onRemovePestamp(i)">Remove</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6">
              <form [formGroup]="detailPestampDialogForm">
                <p class="subtitle fullwidth">Comments</p>
                <mat-form-field appearance="fill" class="fullwidth">
                  <mat-label>comments</mat-label>
                  <textarea style="height: 136px; resize: none;" matInput placeholder="Ex. Start typing here..."
                    [formControl]="designcomments"></textarea>
                </mat-form-field>
                <!-- <div class="col">
                                <button *ngIf=" this.data.pestamp.propertytype=='residential' && this.data.pestamp.modeofstamping=='ecopy'"
                                    style="margin-bottom: 5px;" class="float-right ml-1" mat-raised-button
                                    (click)="uploadnewpestamp(0)">Submit</button>
                            </div> -->
              </form>
            </div>
          </div>


          <form [formGroup]="detailPestampDialogForm">
            <div class="row">
              <div class="col-6 " *ngIf="this.data.pestamp.propertytype=='commercial'">
                <p class="subtitle fullwidth">Working hours</p>
                <mat-form-field class="fullwidth">
                  <input matInput type="text" (keypress)="numberOnly($event)" min="1" maxlength="2"
                    placeholder="working hours" [formControl]="workinghours" required>
                  <mat-error *ngIf="workinghours.invalid">{{getErrorMessage(workinghours)}}</mat-error>
                </mat-form-field>
              </div>
              <div class="col-6"
                *ngIf="(this.data.pestamp.modeofstamping=='hardcopy' || this.data.pestamp.modeofstamping=='both') "
                style="padding-left: 7px;">
                <div class="col">
                  <p class="subtitle fullwidth">Shipping Charges</p>
                  <mat-form-field class="fullwidth">
                    <mat-label>Shipping Charges</mat-label>
                    <input matInput type="number" maxlength="4" min="1" [formControl]="deliverycharges" required>
                    <mat-error *ngIf="deliverycharges.invalid">{{getErrorMessage(deliverycharges)}}</mat-error>
                  </mat-form-field>
                </div>
              </div>

            </div>

          </form>
          <div class="row">
            <div class="col">
              <div class="col">
                <button style=" margin-bottom: 5px; float: right;" mat-raised-button
                  (click)="uploadnewpestamp(0)">Submit</button>
              </div>
            </div>
          </div>
        </ng-container>

        <div class="row"
          *ngIf="(data.pestamp.status=='pesuperadminassigned' || data.pestamp.status=='assigned') && isWattmonkadmins && isShowReassign ">
          <div class="col">
            <div class="col">
              <button style=" margin-bottom: 5px; float: right;" mat-raised-button
                (click)="OpenReassignDialog(data.pestamp)">Reassign</button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>